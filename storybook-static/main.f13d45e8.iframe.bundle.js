(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1139:function(module,exports,__webpack_require__){"use strict";(function(module){(0,__webpack_require__(600).configure)([__webpack_require__(1140),__webpack_require__(1142)],module,!1)}).call(this,__webpack_require__(253)(module))},1140:function(module,exports,__webpack_require__){var map={"./dvdrental/index.stories.mdx":1141};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=1140},1141:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"__page",(function(){return __page}));__webpack_require__(0);var _mdx_js_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(161),_storybook_addon_docs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(406);function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}const layoutProps={};function MDXContent({components:components,...props}){return Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)("wrapper",_extends({},layoutProps,props,{components:components,mdxType:"MDXLayout"}),Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)(_storybook_addon_docs__WEBPACK_IMPORTED_MODULE_2__.b,{title:"index",mdxType:"Meta"}),Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)("h1",{id:"pro-pg-exampe"},"Pro-pg Exampe"))}MDXContent.isMDXComponent=!0;const __page=()=>{throw new Error("Docs-only story")};__page.parameters={docsOnly:!0};const componentMeta={title:"index",includeStories:["__page"]},mdxStoryNameToKey={};componentMeta.parameters=componentMeta.parameters||{},componentMeta.parameters.docs={...componentMeta.parameters.docs||{},page:()=>Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)(_storybook_addon_docs__WEBPACK_IMPORTED_MODULE_2__.a,{mdxStoryNameToKey:mdxStoryNameToKey,mdxComponentMeta:componentMeta},Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)(MDXContent,null))},__webpack_exports__.default=componentMeta},1142:function(module,exports,__webpack_require__){var map={"./dvdrental/index.stories.tsx":1296};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=1142},1296:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"_0_default",(function(){return index_stories_0_default})),__webpack_require__.d(__webpack_exports__,"_1_light_table",(function(){return index_stories_1_light_table})),__webpack_require__.d(__webpack_exports__,"_2_alter_column_display",(function(){return index_stories_2_alter_column_display})),__webpack_require__.d(__webpack_exports__,"_3_search",(function(){return index_stories_3_search})),__webpack_require__.d(__webpack_exports__,"_4_add_operates",(function(){return index_stories_4_add_operates})),__webpack_require__.d(__webpack_exports__,"_5_one_to_one_relation",(function(){return index_stories_5_one_to_one_relation})),__webpack_require__.d(__webpack_exports__,"_6_one_to_many_relation",(function(){return index_stories_6_one_to_many_relation})),__webpack_require__.d(__webpack_exports__,"_7_many_to_many_relation",(function(){return index_stories_7_many_to_many_relation}));var objectSpread2=__webpack_require__(15),react=__webpack_require__(0),react_default=__webpack_require__.n(react),QueryClientProvider=__webpack_require__(407),jsx_runtime=__webpack_require__(8),ClientContext=react_default.a.createContext(null),ClientContext_ClientProvider=function ClientProvider(_ref){var client=_ref.client,children=_ref.children;return Object(jsx_runtime.jsx)(ClientContext.Provider,{value:client,children:Object(jsx_runtime.jsx)(QueryClientProvider.a,{client:client.queryClient,children:children})})},ClientContext_useClient=function useClient(){return Object(react.useContext)(ClientContext)};ClientContext_ClientProvider.__docgenInfo={description:"",methods:[],displayName:"ClientProvider",props:{client:{required:!0,tsType:{name:"signature",type:"object",raw:"{\r\n  pg: PostgrestClient\r\n  pg_base: PostgrestClient\r\n  queryClient: QueryClient\r\n  supabase: SupabaseClient\r\n  supabase_base: SupabaseClient\r\n  staticMeta: any\r\n  config: Config<definitions>\r\n}",signature:{properties:[{key:"pg",value:{name:"PostgrestClient",required:!0}},{key:"pg_base",value:{name:"PostgrestClient",required:!0}},{key:"queryClient",value:{name:"QueryClient",required:!0}},{key:"supabase",value:{name:"SupabaseClient",required:!0}},{key:"supabase_base",value:{name:"SupabaseClient",required:!0}},{key:"staticMeta",value:{name:"any",required:!0}},{key:"config",value:{name:"Config",elements:[{name:"any"}],raw:"Config<definitions>",required:!0}}]}},description:""},children:{required:!0,tsType:{name:"any"},description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\db\\client\\ClientContext.tsx"]={name:"ClientProvider",docgenInfo:ClientContext_ClientProvider.__docgenInfo,path:"src\\core\\db\\client\\ClientContext.tsx"});var objectWithoutProperties=__webpack_require__(48),es=__webpack_require__(229),toConsumableArray=__webpack_require__(108),regenerator=__webpack_require__(29),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=__webpack_require__(56),PlusOutlined=__webpack_require__(749),EditOutlined=__webpack_require__(751),components_SchemaForm=__webpack_require__(674),es_button=__webpack_require__(72),es_table=__webpack_require__(447),space=__webpack_require__(52),lodash=__webpack_require__(7),defineProperty=__webpack_require__(77),slicedToArray=__webpack_require__(67),useQuery=__webpack_require__(1323),useMutation=__webpack_require__(1325),createForOfIteratorHelper=__webpack_require__(728),toPropertyKey=__webpack_require__(439),_excluded=["_form","_search","_table"],_excluded2=["_form","_search","_table"],schema_toSchema=function toSchema(_ref){var columns=_ref.columns,custom=_ref.custom,db=_ref.db,name=_ref.name,id=_ref.id,select=_ref.select,sort=_ref.sort,isView=_ref.isView,table=[],form=[];columns.forEach((function(_ref2){var _form=_ref2._form,_search=_ref2._search,_table=_ref2._table,base=Object(objectWithoutProperties.a)(_ref2,_excluded);if(!1!==_table){if(table.push(Object(lodash.defaultsDeep)({hideInSearch:!0},_table,base)),!base.hideInSearch&&!1!==_search){var search=Object(lodash.defaultsDeep)({hideInSearch:!1,hideInTable:!0,hideInDescriptions:!0},_search,_table,base);Object(lodash.unset)(search,"formItemProps.rules"),table.push(search)}}else table.push(Object(lodash.defaultsDeep)({hideInSearch:!0,hideInTable:!0},base));!1!==_form&&Object(lodash.castArray)(_form||{}).map((function(item){return form.push(Object(lodash.defaultsDeep)({},item,base))}))}));var customForms=Object(lodash.mapValues)(custom,(function(columns){var form=[];return columns.forEach((function(_ref3){var _form=_ref3._form,base=(_ref3._search,_ref3._table,Object(objectWithoutProperties.a)(_ref3,_excluded2));return Object(lodash.castArray)(_form||{}).map((function(item){return form.push(Object(lodash.defaultsDeep)({},item,base))}))})),form}));return isView&&(Object(lodash.each)(table,(function(column){return column.editable=!1})),Object(lodash.each)(form,(function(column){return column.readonly=!0}))),{table:table,form:form,customForms:customForms,db:db,name:name,id:id,select:select,sort:sort,isView:isView}},schema_getSearchSchema=function getSearchSchema(schema,field){return Object(lodash.find)(schema.table,(function(_ref4){var dataIndex=_ref4.dataIndex,search=_ref4.search,hideInSearch=_ref4.hideInSearch;return(!field||dataIndex===field)&&!1!==search&&!0!==hideInSearch}))},fetchMeta=function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(pg_base){var _primary_keys,_foreign_keys,_columns,_views,meta;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,pg_base.from("primary_key").select();case 2:return _primary_keys=_context.sent.data,_context.next=5,pg_base.from("foreign_key").select();case 5:return _foreign_keys=_context.sent.data,_context.next=8,pg_base.from("column").select();case 8:return _columns=_context.sent.data,_context.next=11,pg_base.from("view").select();case 11:return _views=_context.sent.data,meta=Object(lodash.chain)(_columns).groupBy("table_name").mapValues((function(__columns,name){var _columns$,keys=Object(lodash.chain)(_primary_keys).filter(["table_name",name]).map("column_name").value(),foreignMap=Object(lodash.chain)(_foreign_keys).filter(["table_name",name]).keyBy("column_name").mapValues((function(item,col){return{from:{table:name,field:col},to:{table:item.foreign_table_name,key:item.foreign_column_name},constraint:item.constraint_name}})).value(),isViewTable=!!Object(lodash.find)(_views,(function(view){return view.view_name===name})),columns=Object(lodash.map)(__columns,(function(column){var dataType=column.data_type,name=column.column_name,enums=column.enums,isText="text"===dataType,isVarChar="character varying"===dataType,isChar="character"===dataType;return{name:name,table:column.table_name,desc:column.description,tableDesc:column.table_description,dataType:dataType,defaultValue:column.column_default,isNullable:"YES"===column.is_nullable,maxLength:column.character_maximum_length,enums:enums,isText:isText,isVarChar:isVarChar,isChar:isChar,isTextType:isText||isVarChar||isChar,isNumber:["smallint","integer","numeric"].includes(dataType),isEnum:enums.length>0,isArray:"ARRAY"===dataType,isDate:dataType.startsWith("timestamp"),isBoolean:"boolean"===dataType,isFullTextSearch:"tsvector"===dataType,isGenerated:"ALWAYS"===column.is_generated,isKey:keys.includes(name),isForeignKey:!!foreignMap[name]}})),cols=Object(lodash.map)(columns,"name");return{isViewTable:isViewTable,tableDesc:null===(_columns$=columns[0])||void 0===_columns$?void 0:_columns$.tableDesc,keys:keys,foreignKeys:Object.keys(foreignMap),cols:cols,columns:columns,embed:foreignMap,joinBy:Object(lodash.chain)(_foreign_keys).groupBy("table_name").pickBy((function(group){return 2===group.length&&Object(lodash.some)(group,(function(item){return item.foreign_table_name===name}))})).mapValues((function(_ref2,joinTable){var _ref3=Object(slicedToArray.a)(_ref2,2),from=_ref3[0],to=_ref3[1];if(to.foreign_table_name===name){var _ref4=[to,from];from=_ref4[0],to=_ref4[1]}return{from:{table:name,key:from.foreign_column_name},by:{table:joinTable,fromKey:from.column_name,toKey:to.column_name},to:{table:to.foreign_table_name,key:to.foreign_column_name}}})).value(),join:Object(lodash.chain)(_foreign_keys).filter({foreign_table_name:name}).keyBy((function(item){return"".concat(item.table_name).concat("__").concat(item.column_name)})).mapValues((function(item){return{from:{table:name,key:item.foreign_column_name},to:{table:item.table_name,field:item.column_name}}})).value()}})).value(),_context.abrupt("return",meta);case 14:case"end":return _context.stop()}}),_callee)})));return function fetchMeta(_x){return _ref.apply(this,arguments)}}(),useTableMeta_tableMeta=function tableMeta(meta){var getColumn=function getColumn(col){return Object(lodash.find)(meta.columns,["name",col])};return Object(objectSpread2.a)(Object(objectSpread2.a)({},meta),{},{getColumn:getColumn,colDesc:function colDesc(col){var _getColumn;return null===(_getColumn=getColumn(col))||void 0===_getColumn?void 0:_getColumn.desc},firstTextCol:function firstTextCol(){var _find;return null===(_find=Object(lodash.find)(meta.columns,(function(column){return column.isTextType})))||void 0===_find?void 0:_find.name},pickColumns:function pickColumns(row){return Object(lodash.pickBy)(row,(function(val,name){var _getColumn2;return meta.cols.includes(name)&&!(null===(_getColumn2=getColumn(name))||void 0===_getColumn2?void 0:_getColumn2.isGenerated)}))},addKeys:function addKeys(cols){return Object(lodash.union)(meta.keys,cols)}})},useTableMeta=function useTableMeta(name){return useTableMeta_useMeta()[name]},useTableMeta_useMeta=function useMeta(){var _useClient=ClientContext_useClient(),pg_base=_useClient.pg_base,queryClient=_useClient.queryClient,staticMeta=_useClient.staticMeta,dbMeta=Object(useQuery.a)("db-meta",(function(){return fetchMeta(pg_base)}),{staleTime:1/0,initialData:staticMeta}).data;return dbMeta===staticMeta&&queryClient.invalidateQueries("db-meta"),Object(react.useMemo)((function(){return Object(lodash.mapValues)(dbMeta,useTableMeta_tableMeta)}),[dbMeta])},USE_LOCAL_DATA="useLocalData",USE_EMPTY_DATA="useEmptyData_jinjivqlajiafiwiisw",action_request=function Request(schema){var pg=ClientContext_useClient().pg,ID=schema.id,client=pg,meta=useTableMeta(schema.name),entity=function entity(){return client.from(schema.name)};return{list:function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(params){var sort,filter,pageSize,_params$current,current,useLocalData,search,query,transformArr,from,to,_args2=arguments;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(sort=_args2.length>1&&void 0!==_args2[1]?_args2[1]:{},filter=_args2.length>2&&void 0!==_args2[2]?_args2[2]:{},pageSize=params.pageSize,_params$current=params.current,current=void 0===_params$current?1:_params$current,useLocalData=params[USE_LOCAL_DATA],search=Object(objectWithoutProperties.a)(params,["pageSize","current",USE_LOCAL_DATA].map(toPropertyKey.a)),!useLocalData){_context2.next=5;break}return _context2.abrupt("return",{data:useLocalData,success:!0});case 5:if(!Object(lodash.includes)(search,USE_EMPTY_DATA)){_context2.next=7;break}return _context2.abrupt("return",{data:[],success:!0});case 7:return query=entity().select(schema.select||"*",{count:"exact"}),transformArr=[],Object(lodash.forIn)(search,function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(val,field){var _ref3,_transform,_operator,valueType,column;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!(""===val||Object(lodash.isArray)(val)&&0===val.length)){_context.next=2;break}return _context.abrupt("return");case 2:_ref3=schema_getSearchSchema(schema,field)||{},_transform=_ref3._transform,_operator=_ref3._operator,valueType=_ref3.valueType,column=meta.getColumn(field),_transform?transformArr.push(_transform(field,val,query)):_operator?query.filter(field,_operator,val):Object(lodash.endsWith)(valueType,"Range")?(query.gte(field,val[0]),query.lte(field,val[1])):column.isEnum?query.gte(field,val):Object(lodash.isArray)(val)?query.in(field,val):!column.isNumber||column.isKey||column.isForeignKey?column.isTextType?query.ilike(field,"%".concat(val,"%")):query.eq(field,val):query.gte(field,val);case 5:case"end":return _context.stop()}}),_callee)})));return function(_x2,_x3){return _ref2.apply(this,arguments)}}()),Object(lodash.each)(filter,(function(v,k){v&&query.in(k,v)})),_context2.next=13,Promise.all(transformArr);case 13:return Object(lodash.each)(Object(lodash.defaults)(sort,schema.sort),(function(v,k){var arr=k.split(".");query=arr.length>1?query.order(arr[1],{ascending:"ascend"===v,foreignTable:arr[0]}):query.order(arr[0],{ascending:"ascend"===v})})),pageSize&&(from=(current-1)*pageSize,to=current*pageSize-1,query=query.range(from,to)),_context2.abrupt("return",query);case 16:case"end":return _context2.stop()}}),_callee2)})));return function list(_x){return _ref.apply(this,arguments)}}(),upsert:function(){var _ref4=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(row){var _yield$query,_yield$query$data,data,query,_iterator,_step,key,val;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:data=meta.pickColumns(Object(lodash.mapValues)(row,(function(val){return Object(lodash.isUndefined)(val)?null:val}))),query=entity().update(data),_iterator=Object(createForOfIteratorHelper.a)(meta.keys),_context3.prev=3,_iterator.s();case 5:if((_step=_iterator.n()).done){_context3.next=16;break}if(key=_step.value,val=data[key],Object(lodash.isNil)(val)){_context3.next=12;break}query.eq(key,val),_context3.next=14;break;case 12:return query=entity().insert(data),_context3.abrupt("break",16);case 14:_context3.next=5;break;case 16:_context3.next=21;break;case 18:_context3.prev=18,_context3.t0=_context3.catch(3),_iterator.e(_context3.t0);case 21:return _context3.prev=21,_iterator.f(),_context3.finish(21);case 24:return _context3.next=26,query;case 26:if(_context3.t2=_yield$query=_context3.sent,_context3.t1=null===_context3.t2,_context3.t1){_context3.next=30;break}_context3.t1=void 0===_yield$query;case 30:if(!_context3.t1){_context3.next=34;break}_context3.t3=void 0,_context3.next=35;break;case 34:_context3.t3=null===(_yield$query$data=_yield$query.data)||void 0===_yield$query$data?void 0:_yield$query$data[0];case 35:return _context3.abrupt("return",_context3.t3);case 36:case"end":return _context3.stop()}}),_callee3,null,[[3,18,21,24]])})));return function upsert(_x4){return _ref4.apply(this,arguments)}}(),delete:function del(row){return entity().delete().eq(ID,row[ID])},batchDel:function batchDel(ids){return entity().delete().in(ID,ids)},batchUpdate:function batchUpdate(ids,set){return entity().update(set).in(ID,ids)}}},useQuery_invalidateQueries=function invalidateQueries(queryClient,table){queryClient.getQueryCache().getAll().forEach((function(item){return Object(lodash.includes)(item.queryKey[0],table)&&queryClient.invalidateQueries(item.queryKey)}))},useQuery_getCacheQuery=function getCacheQuery(queryClient,table,params){return queryClient.getQueryCache().getAll().find((function(item){return item.queryKey[1]===table&&Object(lodash.isEqual)(item.queryKey[2],params)}))},useQuery_useQueryRequest=function useQueryRequest(schema,actionRef){var queryClient=ClientContext_useClient().queryClient,request=action_request(schema),_useState=Object(react.useState)([]),_useState2=Object(slicedToArray.a)(_useState,2),params=_useState2[0],setParams=_useState2[1],_useState3=Object(react.useState)(!1),_useState4=Object(slicedToArray.a)(_useState3,2),enabledQuery=_useState4[0],setEnabledQuery=_useState4[1],relatedTables=Object(lodash.chain)(Object(toConsumableArray.a)(schema.select.matchAll(/:([!a-zA-Z_]+)\(/g))).map((function(item){return item[1].split("!")})).flatten().unshift(schema.name).value(),_useQuery2=Object(useQuery.a)([relatedTables,schema.name].concat(Object(toConsumableArray.a)(params)),Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee6(){return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,request.list.apply(request,Object(toConsumableArray.a)(Object(lodash.cloneDeep)(params)));case 2:return _context6.abrupt("return",_context6.sent);case 3:case"end":return _context6.stop()}}),_callee6)}))),{enabled:enabledQuery,keepPreviousData:!0}),isLoading=_useQuery2.isLoading,isFetching=_useQuery2.isFetching,_useQuery2$data=_useQuery2.data,data=(_useQuery2$data=void 0===_useQuery2$data?{total:0}:_useQuery2$data).data,total=_useQuery2$data.total;Object(react.useMemo)((function(){var _actionRef$current,_actionRef$current$se;null==actionRef||null===(_actionRef$current=actionRef.current)||void 0===_actionRef$current||null===(_actionRef$current$se=_actionRef$current.setPageInfo)||void 0===_actionRef$current$se||_actionRef$current$se.call(_actionRef$current,{total:total})}),[total]);var _onMutate,requestFromPage=function(){var _ref3=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(){var _len,params,_key,_args3=arguments;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:for(_len=_args3.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=_args3[_key];return setParams(params),!enabledQuery&&setEnabledQuery(!0),_context3.abrupt("return",{total:total});case 4:case"end":return _context3.stop()}}),_callee3)})));return function requestFromPage(){return _ref3.apply(this,arguments)}}(),updateMutation=Object(useMutation.a)(request.upsert,{onMutate:(_onMutate=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(newData){var cache,previousData;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!(cache=useQuery_getCacheQuery(queryClient,schema.name,Object(defineProperty.a)({},schema.id,newData[schema.id])))){_context4.next=5;break}return previousData=queryClient.getQueryData(cache.queryKey),queryClient.setQueryData(cache.queryKey,(function(old){return Object(lodash.merge)(previousData,{data:[newData]})})),_context4.abrupt("return",{previousData:previousData,queryKey:cache.queryKey});case 5:case"end":return _context4.stop()}}),_callee4)}))),function onMutate(_x){return _onMutate.apply(this,arguments)}),onError:function onError(err,newTodo,context){context.previousData&&queryClient.setQueryData(context.queryKey,context.previousData)},onSettled:function onSettled(){useQuery_invalidateQueries(queryClient,schema.name)}}),otherRequestMethod=new Proxy(Object(lodash.omit)(request,"list"),{get:function get(obj,prop){var _this2=this;return Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee5(){var _len2,args,_key2,result,_args5=arguments;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:for(_len2=_args5.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=_args5[_key2];return _context5.next=3,obj[prop].apply(_this2,args);case 3:return result=_context5.sent,useQuery_invalidateQueries(queryClient,schema.name),_context5.abrupt("return",result);case 6:case"end":return _context5.stop()}}),_callee5)})))}});return Object(objectSpread2.a)({list:{dataSource:data,loading:isFetching,request:requestFromPage},one:{dataSource:null==data?void 0:data[0],loading:isLoading,request:requestFromPage},update:function update(newData){return updateMutation.mutate(newData),newData}},otherRequestMethod)},EllipsisOutlined=__webpack_require__(441),dropdown=__webpack_require__(189),es_menu=__webpack_require__(129),usePromise=__webpack_require__(1326),Button_excluded=["children","action","name"],Button_excluded2=["action"],Button_ActionButton=function ActionButton(_ref){var children=_ref.children,action=_ref.action,name=_ref.name,props=Object(objectWithoutProperties.a)(_ref,Button_excluded),_useState=Object(react.useState)(!1),_useState2=Object(slicedToArray.a)(_useState,2),loading=_useState2[0],setLoading=_useState2[1],mounted=Object(usePromise.a)(),onClick=function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return setLoading(!0),_context.next=3,mounted(action());case 3:setLoading(!1);case 4:case"end":return _context.stop()}}),_callee)})));return function onClick(){return _ref2.apply(this,arguments)}}();return Object(jsx_runtime.jsx)(es_button.a,Object(objectSpread2.a)(Object(objectSpread2.a)({loading:loading,onClick:onClick},props),{},{children:children||name}))},Button_Link=function Link(_ref3){var action=_ref3.action,props=Object(objectWithoutProperties.a)(_ref3,Button_excluded2);return Object(jsx_runtime.jsx)(Button_ActionButton,Object(objectSpread2.a)({action:action,type:"link",size:"small",style:{padding:"0 0"}},props))},Button_LinkMenu=function LinkMenu(_ref4){var menu=_ref4.menu,_useState3=Object(react.useState)(!1),_useState4=Object(slicedToArray.a)(_useState3,2),loading=_useState4[0],setLoading=_useState4[1],onClick=function(){var _ref6=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(_ref5){var key,item;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(key=_ref5.key,setLoading(!0),item=Object(lodash.find)(menu,{name:key}),_context2.t0=!item.form,!_context2.t0){_context2.next=7;break}return _context2.next=7,item.action();case 7:setLoading(!1);case 8:case"end":return _context2.stop()}}),_callee2)})));return function onClick(_x){return _ref6.apply(this,arguments)}}();return Object(jsx_runtime.jsx)(dropdown.a,{overlay:Object(jsx_runtime.jsx)(es_menu.a,{onClick:onClick,children:menu.map((function(_ref7){var name=_ref7.name,disabled=_ref7.disabled,form=_ref7.form,action=_ref7.action;return Object(jsx_runtime.jsx)(es_menu.a.Item,{disabled:disabled,children:form?Object(jsx_runtime.jsx)(components_SchemaForm.a,{layoutType:"ModalForm",onFinish:action,columns:form,trigger:Object(jsx_runtime.jsx)("a",{children:name})}):name},name)}))}),children:Object(jsx_runtime.jsx)(es_button.a,{loading:loading,shape:"round",type:"dashed",size:"small",children:Object(jsx_runtime.jsx)(EllipsisOutlined.a,{})})})};Button_ActionButton.__docgenInfo={description:"ActionButton  :   auto add loading",methods:[],displayName:"ActionButton",props:{action:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<any>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"any"}],raw:"Promise<any>"}}},description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\action\\Button.tsx"]={name:"ActionButton",docgenInfo:Button_ActionButton.__docgenInfo,path:"src\\core\\action\\Button.tsx"}),Button_Link.__docgenInfo={description:"Link",methods:[],displayName:"Link",props:{action:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<any>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"any"}],raw:"Promise<any>"}}},description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\action\\Button.tsx"]={name:"Link",docgenInfo:Button_Link.__docgenInfo,path:"src\\core\\action\\Button.tsx"}),Button_LinkMenu.__docgenInfo={description:"Menu",methods:[],displayName:"LinkMenu"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\action\\Button.tsx"]={name:"LinkMenu",docgenInfo:Button_LinkMenu.__docgenInfo,path:"src\\core\\action\\Button.tsx"});var operate_excluded=["form"],tag=__webpack_require__(746),valuetype_array={render:function render(val){return null==val?void 0:val.map((function(v,i){return Object(jsx_runtime.jsx)(tag.a,{children:v},i)}))},editable:!1,_search:!1,_form:{valueType:"formList",columns:[{dataIndex:[],width:"md"}]}},CheckCircleTwoTone=__webpack_require__(1328),valuetype_boolean=function boolean(_ref){return{valueType:"switch",render:function render(dom,entity,index,action,schema){return entity[schema.dataIndex]?Object(jsx_runtime.jsx)(CheckCircleTwoTone.a,{style:{fontSize:"18px"},twoToneColor:"#52c41a"}):""},_search:{valueType:"select",fieldProps:{options:[{label:"是",value:!0},{label:"否",value:!1}]}},_form:{initialValue:"true"===_ref.defaultValue}}},valuetype_date={valueType:"date",sorter:!0,_search:{valueType:"dateRange"}},typography=__webpack_require__(739),popover=__webpack_require__(228),drawer=__webpack_require__(741),toArray=__webpack_require__(735),pro_descriptions_es=__webpack_require__(435),useGetDefaultCols_useGetDefaultCols=function useGetDefaultCols(){var dbMeta=useTableMeta_useMeta(),config=ClientContext_useClient().config;return function(table){var _config$cols;if(!dbMeta[table])throw Error(table+" 's meta not exist.");return(null===(_config$cols=config.cols)||void 0===_config$cols?void 0:_config$cols[table])||Object(lodash.castArray)(dbMeta[table].firstTextCol()||dbMeta[table].cols[0])}},MiniDesc_excluded=["table","id","entity"],MiniDesc_MiniDesc=function MiniDesc(_ref){var _chain$union,table=_ref.table,id=_ref.id,entity=_ref.entity,props=Object(objectWithoutProperties.a)(_ref,MiniDesc_excluded),actionRef=Object(react.useRef)(),meta=useTableMeta(table),schema=schema_useSchema(table,{},{cols:lodash.without.apply(void 0,[meta.cols].concat(Object(toConsumableArray.a)(meta.foreignKeys)))}).schema,_useAction=useAction_useAction({schema:schema,actionRef:actionRef}),request=_useAction.request,columns=_useAction.columns;Object(react.useEffect)((function(){request.one.request(Object(defineProperty.a)({},schema.id,id))}),[]);var data=request.one.dataSource||entity||{},getDefaultCols=useGetDefaultCols_useGetDefaultCols(),_chain$union$without$=(_chain$union=Object(lodash.chain)(getDefaultCols(table)).union(meta.cols)).without.apply(_chain$union,Object(toConsumableArray.a)(meta.foreignKeys)).slice(0,5).value(),_chain$union$without$2=Object(toArray.a)(_chain$union$without$),titleCol=_chain$union$without$2[0],otherCols=_chain$union$without$2.slice(1);return Object(jsx_runtime.jsx)(pro_descriptions_es.a,Object(objectSpread2.a)({dataSource:data,title:data[titleCol],columns:lodash.without.apply(void 0,[otherCols].concat(Object(toConsumableArray.a)(meta.keys))).map((function(col){return columns.find((function(item){return item.dataIndex===col}))})),actionRef:actionRef,size:"small",column:1,style:{width:"250px"}},props))};MiniDesc_MiniDesc.__docgenInfo={description:"",methods:[],displayName:"MiniDesc",props:{table:{required:!0,tsType:{name:"any"},description:""},id:{required:!0,tsType:{name:"any"},description:""},entity:{required:!0,tsType:{name:"any"},description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\descriptions\\MiniDesc.tsx"]={name:"MiniDesc",docgenInfo:MiniDesc_MiniDesc.__docgenInfo,path:"src\\core\\ui\\descriptions\\MiniDesc.tsx"});var modal=__webpack_require__(736),modal_default=__webpack_require__.n(modal),Dialog_Dialog=function Dialog(_ref){var trigger=_ref.trigger,children=_ref.children,_ref$width=_ref.width,width=void 0===_ref$width?"700px":_ref$width,_useState=Object(react.useState)(!1),_useState2=Object(slicedToArray.a)(_useState,2),visible=_useState2[0],setVisible=_useState2[1],hide=function hide(){return setVisible(!1)};return Object(jsx_runtime.jsxs)("span",{onKeyDown:function onKeyDown(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())},children:[Object(jsx_runtime.jsx)("a",{onClick:function show(){return setVisible(!0)},children:trigger}),Object(jsx_runtime.jsx)(modal_default.a,{footer:null,visible:visible,width:width,onOk:hide,onCancel:hide,closable:!0,destroyOnClose:!0,children:children})]})};Dialog_Dialog.__docgenInfo={description:"",methods:[],displayName:"Dialog",props:{width:{defaultValue:{value:"'700px'",computed:!1},required:!1}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\components\\Dialog.tsx"]={name:"Dialog",docgenInfo:Dialog_Dialog.__docgenInfo,path:"src\\core\\ui\\components\\Dialog.tsx"});var LightTable_excluded=["schema","tableDesc","subTitle","operates"],LightTable_LightTable=function LightTable(_ref){var schema=_ref.schema,tableDesc=_ref.tableDesc,subTitle=_ref.subTitle,operates=_ref.operates,props=Object(objectWithoutProperties.a)(_ref,LightTable_excluded),actionRef=Object(react.useRef)(),_useAction=useAction_useAction({schema:schema,actionRef:actionRef,operates:operates||[]}),request=_useAction.request,columns=_useAction.columns,editable=(_useAction.Create,_useAction.Action,_useAction.editable),batch=_useAction.batch,keys=(_useAction.ID,useTableMeta(schema.name).keys);return Object(jsx_runtime.jsx)(es.a,Object(objectSpread2.a)(Object(objectSpread2.a)(Object(objectSpread2.a)(Object(objectSpread2.a)({},request.list),{},{columns:columns,actionRef:actionRef,editable:editable,rowKey:keys.join(","),search:{filterType:"light",ignoreRules:!0},type:"table",postData:function postData(data){return Object(lodash.map)(data,(function(row){return Object(objectSpread2.a)(Object(objectSpread2.a)({},row),{},Object(defineProperty.a)({},keys.join(","),Object(lodash.at)(row,keys).join(",")))}))},form:{collapse:!0,ignoreRules:!0},options:{setting:!0,density:!1,fullScreen:!0,reload:!1},pagination:{pageSize:10,simple:!0},dateFormatter:"string",toolbar:{title:tableDesc||schema.name,subTitle:subTitle}},batch),operates&&1!==operates.length?{}:{rowSelection:!1}),props))};LightTable_LightTable.__docgenInfo={description:"",methods:[],displayName:"LightTable",props:{schema:{required:!0,tsType:{name:"Schema"},description:""},tableDesc:{required:!1,tsType:{name:"string"},description:""},subTitle:{required:!1,tsType:{name:"string"},description:""},operates:{required:!1,tsType:{name:"Array",elements:[{name:"Operate",elements:[{name:"T"}],raw:"Operate<T>"}],raw:"Operate<T>[]"},description:""}}};var table_LightTable=LightTable_LightTable;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\table\\LightTable.tsx"]={name:"LightTable",docgenInfo:LightTable_LightTable.__docgenInfo,path:"src\\core\\ui\\table\\LightTable.tsx"});var Desc_excluded=["table","id"],Desc_Desc=function Desc(_ref){var table=_ref.table,id=_ref.id,props=Object(objectWithoutProperties.a)(_ref,Desc_excluded),actionRef=Object(react.useRef)(),_useSchema=schema_useSchema(table,{},{cols:[]}),schema=_useSchema.schema,tableDesc=_useSchema.tableDesc,_useAction=useAction_useAction({schema:schema,actionRef:actionRef}),request=_useAction.request,columns=_useAction.columns,editable=_useAction.editable,getDefaultCols=useGetDefaultCols_useGetDefaultCols();return Object(jsx_runtime.jsx)(pro_descriptions_es.a,Object(objectSpread2.a)(Object(objectSpread2.a)({},request.one),{},{params:Object(defineProperty.a)({},schema.id,id),title:Object(jsx_runtime.jsx)(Dialog_Dialog,{trigger:tableDesc||table,children:Object(jsx_runtime.jsx)(table_LightTable,Object(objectSpread2.a)({},schema_useSchema(table,{},{cols:getDefaultCols(table)})))}),columns:columns,actionRef:actionRef,editable:editable},props))};Desc_Desc.__docgenInfo={description:"",methods:[],displayName:"Desc",props:{table:{required:!0,tsType:{name:"any"},description:""},id:{required:!0,tsType:{name:"any"},description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\descriptions\\Desc.tsx"]={name:"Desc",docgenInfo:Desc_Desc.__docgenInfo,path:"src\\core\\ui\\descriptions\\Desc.tsx"});var DrawerDesc_DrawerDesc=function DrawerDesc(_ref){var table=_ref.table,id=_ref.id,_ref$children=_ref.children,children=void 0===_ref$children?null:_ref$children,_ref$entity=_ref.entity,entity=void 0===_ref$entity?null:_ref$entity,_useState=Object(react.useState)(!1),_useState2=Object(slicedToArray.a)(_useState,2),visible=_useState2[0],setVisible=_useState2[1];return Object(jsx_runtime.jsxs)("span",{children:[Object(jsx_runtime.jsx)(popover.a,{content:function content(){return Object(jsx_runtime.jsx)(MiniDesc_MiniDesc,{table:table,id:id,entity:entity})},mouseEnterDelay:.5,children:Object(jsx_runtime.jsx)("a",{onClick:function show(){return setVisible(!0)},children:children||id})}),Object(jsx_runtime.jsx)(drawer.a,{width:700,closable:!0,onClose:function hide(){return setVisible(!1)},visible:visible,destroyOnClose:!0,push:!1,children:Object(jsx_runtime.jsx)(Desc_Desc,{table:table,id:id,column:1,bordered:!0,size:"default",labelStyle:{width:"200px"}})})]})};DrawerDesc_DrawerDesc.__docgenInfo={description:"",methods:[],displayName:"DrawerDesc",props:{children:{defaultValue:{value:"null",computed:!1},required:!1},entity:{defaultValue:{value:"null",computed:!1},required:!1}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\descriptions\\DrawerDesc.tsx"]={name:"DrawerDesc",docgenInfo:DrawerDesc_DrawerDesc.__docgenInfo,path:"src\\core\\ui\\descriptions\\DrawerDesc.tsx"});var rpc_useRPC=function useRPC(){var _useClient=ClientContext_useClient(),pg_base=_useClient.pg_base,queryClient=_useClient.queryClient;return function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(name,params){var relatedTables;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return relatedTables=Object(lodash.filter)(params,(function(val,key){return Object(lodash.endsWith)(key,"table")})),_context2.abrupt("return",queryClient.fetchQuery([relatedTables,name,params],Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,pg_base.rpc(name,params);case 2:if(_context.t0=_context.sent.data,_context.t0){_context.next=5;break}_context.t0=[];case 5:return _context.abrupt("return",_context.t0);case 6:case"end":return _context.stop()}}),_callee)})))));case 2:case"end":return _context2.stop()}}),_callee2)})));return function(_x,_x2){return _ref.apply(this,arguments)}}()},es_select=__webpack_require__(175),Select_excluded=["request","initOptions"],Select_SelectBase=function SelectBase(_ref){var request=_ref.request,_ref$initOptions=_ref.initOptions,initOptions=void 0===_ref$initOptions?[]:_ref$initOptions,props=Object(objectWithoutProperties.a)(_ref,Select_excluded),_useState=Object(react.useState)(),_useState2=Object(slicedToArray.a)(_useState,2),searchOptions=_useState2[0],setSearchOptions=_useState2[1],_useState3=Object(react.useState)(!1),_useState4=Object(slicedToArray.a)(_useState3,2),loading=_useState4[0],setLoading=_useState4[1],search=function search(value){setLoading(!0),setSearchOptions([]),request(value).then((function(data){setSearchOptions(data),setLoading(!1)}))};return Object(jsx_runtime.jsx)(es_select.a,Object(objectSpread2.a)({options:searchOptions||initOptions,showSearch:!0,allowClear:!0,onSearch:search,onFocus:function onFocus(){return Object(lodash.isEmpty)(searchOptions)&&search("")},onClear:function onClear(){return search("")},loading:loading},props))};Select_SelectBase.__docgenInfo={description:"",methods:[],displayName:"SelectBase",props:{initOptions:{defaultValue:{value:"[]",computed:!1},required:!1}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\select\\Select.tsx"]={name:"SelectBase",docgenInfo:Select_SelectBase.__docgenInfo,path:"src\\core\\ui\\select\\Select.tsx"});var SelectForeignTable_excluded=["table","field","by","constraint"],SelectForeignTable_SelectForeignTable=function SelectForeignTable(_ref){var table=_ref.table,field=_ref.field,by=_ref.by,_ref$constraint=Object(slicedToArray.a)(_ref.constraint,3),fromTable=_ref$constraint[0],fromField=_ref$constraint[1],params=_ref$constraint[2],props=Object(objectWithoutProperties.a)(_ref,SelectForeignTable_excluded),rpc=rpc_useRPC();return Object(jsx_runtime.jsx)(Select_SelectBase,Object(objectSpread2.a)({request:function request(value){return rpc("select_foreign",{table:table,field:field,filter:[by,"%".concat(value,"%")],constraint:[fromTable,fromField,params?Object(lodash.map)(params,(function(v,k){return" and t.".concat(k,"=").concat(v," ")})).join(""):""]})}},props))};SelectForeignTable_SelectForeignTable.__docgenInfo={description:"",methods:[],displayName:"SelectForeignTable"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\select\\SelectForeignTable.tsx"]={name:"SelectForeignTable",docgenInfo:SelectForeignTable_SelectForeignTable.__docgenInfo,path:"src\\core\\ui\\select\\SelectForeignTable.tsx"});var SelectTable_excluded=["table","field","by"],Text=typography.a.Text,SelectTable_SelectTable=(typography.a.Link,function SelectTable(_ref){var table=_ref.table,key=_ref.field,cols=_ref.by,props=Object(objectWithoutProperties.a)(_ref,SelectTable_excluded),queryTable=function useQueryTable(){var _useClient=ClientContext_useClient(),pg=_useClient.pg,queryClient=_useClient.queryClient;return function(table){var builder=pg.from(table),_then=builder.then;return builder.then=function(resolve,reject){var _this=this,url=this.url,params={};return url.searchParams.forEach((function(val,key){return params[key]=val})),queryClient.fetchQuery([[table],table,params],Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,new Promise((function(r){return _then.call(_this,r)}));case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}}),_callee)})))).then((function(data){return resolve(data)}))},builder}}(),customOption=function customOption(_ref2){var _cols$=cols[0],value=_ref2.value,label=_ref2[_cols$],other=Object(objectWithoutProperties.a)(_ref2,["value",_cols$].map(toPropertyKey.a));return{value:value,label:Object(jsx_runtime.jsxs)(space.b,{children:[Object(jsx_runtime.jsx)(Text,{children:label}),Object(lodash.map)(other,(function(v,k){return Object(jsx_runtime.jsx)(Text,{type:"secondary",children:v},k)}))]})}},_useState=Object(react.useState)([]),_useState2=Object(slicedToArray.a)(_useState,2),initOptions=_useState2[0],setInitOptions=_useState2[1];return Object(react.useEffect)((function(){props.value?queryTable(table).select("value:".concat(key,",").concat(cols.join(","))).eq(key,props.value).then((function(_ref3){var data=_ref3.data;return setInitOptions(data.map(customOption))})):setInitOptions([])}),[]),Object(jsx_runtime.jsx)(Select_SelectBase,Object(objectSpread2.a)({filterOption:!1,initOptions:initOptions,request:function(){var _ref4=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(value){var _yield$queryTable$sel;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,queryTable(table).select("value:".concat(key,",").concat(cols.join(","))).ilike(cols[0],"%".concat(value,"%")).limit(8);case 2:if(_context.t1=_yield$queryTable$sel=_context.sent.data,_context.t0=null===_context.t1,_context.t0){_context.next=6;break}_context.t0=void 0===_yield$queryTable$sel;case 6:if(!_context.t0){_context.next=10;break}_context.t2=void 0,_context.next=11;break;case 10:_context.t2=_yield$queryTable$sel.map(customOption);case 11:return _context.abrupt("return",_context.t2);case 12:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref4.apply(this,arguments)}}()},props))});SelectTable_SelectTable.__docgenInfo={description:"",methods:[],displayName:"SelectTable"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\select\\SelectTable.tsx"]={name:"SelectTable",docgenInfo:SelectTable_SelectTable.__docgenInfo,path:"src\\core\\ui\\select\\SelectTable.tsx"});var embed_excluded=["dataIndex"],embed_Text=typography.a.Text,embed_addEmbed=(typography.a.Link,function addEmbed(draft,params){var meta=useTableMeta(draft.name),getDefaultCols=useGetDefaultCols_useGetDefaultCols();draft.columns=Object(lodash.chain)(draft.columns).map((function(item){var name=item.dataIndex,desc=meta.colDesc(name);if(function isEmbed(item){var _item$_column;return null===(_item$_column=item._column)||void 0===_item$_column?void 0:_item$_column.isForeignKey}(item)){var _embed2,_meta$embed$name=meta.embed[name],_meta$embed$name$to=_meta$embed$name.to,table=_meta$embed$name$to.table,_key=_meta$embed$name$to.key,constraint=_meta$embed$name.constraint,_embed=item._embed,cols=Object(lodash.isEmpty)(_embed)?getDefaultCols(table):Object(lodash.keys)(_embed),embedDraft=schema_useSchema(table,_embed||{},{cols:cols,type:"embed",returnDraft:!0,params:{name:name,desc:desc,cols:cols}}).draft,alias="".concat("embed__").concat(name);return!1!==_embed&&(draft.select="".concat(draft.select,",").concat(alias,":").concat(table,"!").concat(constraint,"(*)")),[Object(objectSpread2.a)(Object(objectSpread2.a)({},item),{},{hideInTable:!1!==_embed,hideInDescriptions:!1!==_embed,title:(null==_embed||null===(_embed2=_embed[embedDraft.columns[0].dataIndex])||void 0===_embed2?void 0:_embed2.title)||Object(jsx_runtime.jsx)(embed_Text,{underline:!0,children:desc||name}),_search:embedDraft.columns[0]._column.isTextType?{renderFormItem:function renderFormItem(){return Object(jsx_runtime.jsx)(SelectForeignTable_SelectForeignTable,{table:table,field:_key,by:cols[0],constraint:[draft.name,name,params],placeholder:embedDraft.columns[0].title})}}:{},_form:{width:"md",renderFormItem:function renderFormItem(){return Object(jsx_runtime.jsx)(SelectTable_SelectTable,{table:table,field:_key,by:cols})}}})].concat(Object(toConsumableArray.a)(!1!==_embed?embedDraft.columns.map((function(_ref,index){var dataIndex=_ref.dataIndex,other=Object(objectWithoutProperties.a)(_ref,embed_excluded);return Object(objectSpread2.a)(Object(objectSpread2.a)({dataIndex:[alias,dataIndex]},other),{},{_search:!1,onFilter:!0,_form:!1,editable:!1})})):[]))}return item})).flatten().value()}),embed_EmbedTitle=function EmbedTitle(_ref4){var col=_ref4.col,table=_ref4.table,foreignKeyDesc=_ref4.desc,_ref4$index=_ref4.index,index=void 0===_ref4$index?0:_ref4$index,type=_ref4.type,meta=table&&useTableMeta(table),colDesc=meta.colDesc(col)||col,tableDesc=foreignKeyDesc||meta.tableDesc||table;return"table"===type?index>0?Object(jsx_runtime.jsx)(space.b,{children:Object(jsx_runtime.jsxs)(embed_Text,{children:[":",colDesc]})}):Object(jsx_runtime.jsx)(embed_Text,{underline:!0,children:tableDesc}):Object(jsx_runtime.jsxs)(space.b,{children:[Object(jsx_runtime.jsx)(embed_Text,{code:!0,children:tableDesc}),Object(jsx_runtime.jsx)("span",{children:":"}),Object(jsx_runtime.jsx)(embed_Text,{children:colDesc})]})},badge=__webpack_require__(165),BadgeNumber_BadgeNumber=function BadgeNumber(_ref){var num=_ref.num;return Object(jsx_runtime.jsx)(badge.a,{count:num,size:"default",style:{fontSize:"15px",marginTop:-2,marginLeft:4,color:num>10?"#1890FF":"#999",backgroundColor:num>5?"#E6F7FF":"#eee"}})};BadgeNumber_BadgeNumber.__docgenInfo={description:"",methods:[],displayName:"BadgeNumber"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\components\\BadgeNumber.tsx"]={name:"BadgeNumber",docgenInfo:BadgeNumber_BadgeNumber.__docgenInfo,path:"src\\core\\ui\\components\\BadgeNumber.tsx"});var StaticTable_StaticTable=function StaticTable(_ref){var table=_ref.table,cols=_ref.cols,_ref$value=_ref.value,value=void 0===_ref$value?[]:_ref$value,_ref$plain=(_ref.onChange,_ref.plain),plain=void 0!==_ref$plain&&_ref$plain,title=_ref.title,subTitle=_ref.subTitle;cols=cols||Object(lodash.keys)(value[0]);var actionRef=Object(react.useRef)(),_useSchema=schema_useSchema(table,{},{cols:cols,type:"static"}),schema=_useSchema.schema,tableDesc=_useSchema.tableDesc,search=schema_getSearchSchema(schema,cols[0]),_useState=Object(react.useState)(""),_useState2=Object(slicedToArray.a)(_useState,2),keyword=_useState2[0],setKeyword=_useState2[1],dataSource=Object(lodash.filter)(value,(function(item){return Object(lodash.includes)(item[search.dataIndex].toString().toLowerCase(),keyword.toLowerCase())}));return Object(react.useEffect)((function(){var _actionRef$current;(null===(_actionRef$current=actionRef.current)||void 0===_actionRef$current?void 0:_actionRef$current.reloadAndRest)&&actionRef.current.reloadAndRest()}),[keyword]),Object(jsx_runtime.jsx)(es.a,Object(objectSpread2.a)({dataSource:dataSource,columns:schema.table,actionRef:actionRef,rowKey:schema.id,search:!1,options:!1,toolbar:{title:title||tableDesc||schema.name,subTitle:subTitle,search:{placeholder:null==search?void 0:search.title,onChange:function onChange(e){setKeyword(e.target.value)}}},pagination:{pageSize:5,simple:!0,hideOnSinglePage:!0}},plain?{headerTitle:null,size:"small",toolbar:null}:{}))};StaticTable_StaticTable.__docgenInfo={description:"",methods:[],displayName:"StaticTable",props:{value:{defaultValue:{value:"[]",computed:!1},required:!1},plain:{defaultValue:{value:"false",computed:!1},required:!1,tsType:{name:"boolean"},description:""},table:{required:!0,tsType:{name:"string"},description:""},cols:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},title:{required:!1,tsType:{name:"string"},description:""},subTitle:{required:!1,tsType:{name:"string"},description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\table\\StaticTable.tsx"]={name:"StaticTable",docgenInfo:StaticTable_StaticTable.__docgenInfo,path:"src\\core\\ui\\table\\StaticTable.tsx"});var join_Text=typography.a.Text,join_addJoin=(typography.a.Link,function addJoin(draft){var getDefaultCols=useGetDefaultCols_useGetDefaultCols();Object(lodash.each)(draft.columns,(function(item){if(function isJoin(column){return Object(lodash.startsWith)(column.dataIndex.toString(),"join__")}(item)){var name=item.dataIndex.toString(),_name$replace$split=name.replace("join__","").split("__"),_name$replace$split2=Object(slicedToArray.a)(_name$replace$split,2),table=_name$replace$split2[0],field=_name$replace$split2[1],_item$cols=item.cols,cols=void 0===_item$cols?Object(lodash.without)(getDefaultCols(table),field):_item$cols,meta=useTableMeta(table);draft.select="".concat(draft.select,",").concat(name,":").concat(table,"!").concat(field,"(").concat(meta.addKeys(cols).join(","),")"),draft.sort["".concat(name,".").concat(meta.keys[0])]="ascend"}}))}),Text_Text=typography.a.Text,pro_card_es=(typography.a.Link,__webpack_require__(448)),es_alert=__webpack_require__(747),JoinTable_excluded=["meta","fromRecord","title","cols","editable"],JoinTable_JoinTable=function JoinTable(_ref){var meta=_ref.meta,fromRecord=_ref.fromRecord,title=_ref.title,_ref$editable=(_ref.cols,_ref.editable),editable=void 0!==_ref$editable&&_ref$editable,other=Object(objectWithoutProperties.a)(_ref,JoinTable_excluded),from=meta.from,by=meta.by;return Object(jsx_runtime.jsx)(table_LightTable,Object(objectSpread2.a)(Object(objectSpread2.a)(Object(objectSpread2.a)({headerTitle:title},schema_useSchema(by.table,Object(defineProperty.a)({},by.fromKey,!1),{params:Object(defineProperty.a)({},by.fromKey,fromRecord[from.key]||USE_EMPTY_DATA)})),editable?{operates:["inline_edit"]}:{}),other))};JoinTable_JoinTable.__docgenInfo={description:"show and  edit join table",methods:[],displayName:"JoinTable",props:{editable:{defaultValue:{value:"false",computed:!1},required:!1}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\schema\\join-table\\join-by\\JoinTable.tsx"]={name:"JoinTable",docgenInfo:JoinTable_JoinTable.__docgenInfo,path:"src\\core\\schema\\join-table\\join-by\\JoinTable.tsx"});var join_table_useJoinTableAction=function useJoinTableAction(meta,fromRecord){var pg=ClientContext_useClient().pg,from=meta.from,to=meta.to,join=meta.by,adds=function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(records){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,pg.from(join.table).upsert(records.map((function(record){var _ref2;return _ref2={},Object(defineProperty.a)(_ref2,join.fromKey,fromRecord[from.key]),Object(defineProperty.a)(_ref2,join.toKey,record[to.key]),_ref2})),{onConflict:[join.fromKey,join.toKey].join(",")});case 2:return _context.abrupt("return",_context.sent.data);case 3:case"end":return _context.stop()}}),_callee)})));return function adds(_x){return _ref.apply(this,arguments)}}(),dels=function(){var _ref3=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(records){return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,pg.from(join.table).delete().eq(join.fromKey,fromRecord[from.key]).in(join.toKey,records.map((function(record){return record[to.key]})));case 2:return _context2.abrupt("return",_context2.sent.data);case 3:case"end":return _context2.stop()}}),_callee2)})));return function dels(_x2){return _ref3.apply(this,arguments)}}(),add=function(){var _ref4=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(record){return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,adds([record]);case 2:return _context3.abrupt("return",_context3.sent[0]);case 3:case"end":return _context3.stop()}}),_callee3)})));return function add(_x3){return _ref4.apply(this,arguments)}}(),del=function(){var _ref5=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(record){return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,dels([record]);case 2:return _context4.abrupt("return",_context4.sent[0]);case 3:case"end":return _context4.stop()}}),_callee4)})));return function del(_x4){return _ref5.apply(this,arguments)}}();return{adds:adds,dels:dels,add:add,del:del}},Mode_All="All",Mode_Sub="Sub",SelectChildren=function(_ref){var _funs2,_funs,meta=_ref.meta,fromRecord=_ref.fromRecord,cols=(_ref.title,_ref.cols),onChange=_ref.onChange,_ref$value=_ref.value,value=void 0===_ref$value?[]:_ref$value,actionRef=Object(react.useRef)(),_useJoinTableAction=join_table_useJoinTableAction(meta,fromRecord),adds=_useJoinTableAction.adds,dels=_useJoinTableAction.dels,key=meta.to.key,isAdded=function isAdded(child){return!!Object(lodash.find)(value,[key,child[key]])},schema=schema_useSchema(meta.to.table,{},{cols:cols}).schema,_useAction=useAction_useAction({schema:schema,actionRef:actionRef,operates:[{name:"添加",funs:(_funs=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(children){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,adds(children);case 2:onChange&&onChange(Object(lodash.unionBy)(value,children,key));case 3:case"end":return _context.stop()}}),_callee)}))),function funs(_x){return _funs.apply(this,arguments)}),hide:isAdded,relaod:!1},{name:"移除",funs:(_funs2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(children){return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,dels(children);case 2:onChange&&onChange(Object(lodash.differenceBy)(value,children,key));case 3:case"end":return _context2.stop()}}),_callee2)}))),function funs(_x2){return _funs2.apply(this,arguments)}),button:{danger:!0},show:isAdded,relaod:!1},{batchDelete:!1}]}),request=_useAction.request,columns=_useAction.columns,batch=_useAction.batch,ID=_useAction.ID,_useSearchKeyword=function(_ref){var searchSchema=_ref.searchSchema,actionRef=_ref.actionRef,_ref$subMode=_ref.subMode,subMode=void 0===_ref$subMode?null:_ref$subMode,_useState=Object(react.useState)(""),_useState2=Object(slicedToArray.a)(_useState,2),keyword=_useState2[0],setKeyword=_useState2[1],_useState3=Object(react.useState)(1),_useState4=Object(slicedToArray.a)(_useState3,2),waitingBack=_useState4[0],setWaitingBack=_useState4[1],_useState5=Object(react.useState)(Mode_All),_useState6=Object(slicedToArray.a)(_useState5,2),mode=_useState6[0],setMode=_useState6[1],params={};params[searchSchema.dataIndex]=keyword,mode===Mode_Sub&&Object.assign(params,Object(lodash.isFunction)(subMode)?subMode():subMode);var toggleMode=function toggleMode(){var _actionRef$current,_actionRef$current$se,_actionRef$current2,_actionRef$current2$p,_actionRef$current3;mode===Mode_Sub?(null===(_actionRef$current=actionRef.current)||void 0===_actionRef$current||null===(_actionRef$current$se=_actionRef$current.setPageInfo)||void 0===_actionRef$current$se||_actionRef$current$se.call(_actionRef$current,{current:waitingBack}),setWaitingBack(1),setMode(Mode_All)):(setWaitingBack(null===(_actionRef$current2=actionRef.current)||void 0===_actionRef$current2||null===(_actionRef$current2$p=_actionRef$current2.pageInfo)||void 0===_actionRef$current2$p?void 0:_actionRef$current2$p.current),null===(_actionRef$current3=actionRef.current)||void 0===_actionRef$current3||_actionRef$current3.setPageInfo({current:1}),setMode(Mode_Sub))},changeMode=function changeMode(to){return to!==mode&&toggleMode()};return{params:params,search:{enterButton:mode===Mode_Sub,placeholder:searchSchema.title,onSearch:function onSearch(value){var _actionRef$current4,_actionRef$current4$s;keyword===value?subMode&&toggleMode():(null===(_actionRef$current4=actionRef.current)||void 0===_actionRef$current4||null===(_actionRef$current4$s=_actionRef$current4.setPageInfo)||void 0===_actionRef$current4$s||_actionRef$current4$s.call(_actionRef$current4,{current:1}),setWaitingBack(1),setKeyword(value))}},menu:function menu(labelAll,labelSub){return{type:"dropdown",activeKey:mode,items:[{label:labelAll,key:Mode_All},{label:labelSub,key:Mode_Sub}],onChange:function onChange(mode){return changeMode(mode)}}}}}({searchSchema:schema_getSearchSchema(schema,cols[0]),actionRef:actionRef,subMode:function subMode(){return value.length>0?Object(defineProperty.a)({},key,Object(lodash.map)(value,key)):Object(defineProperty.a)({},USE_LOCAL_DATA,[])}}),search=_useSearchKeyword.search,params=_useSearchKeyword.params,menu=_useSearchKeyword.menu;return Object(jsx_runtime.jsx)(es.a,Object(objectSpread2.a)(Object(objectSpread2.a)({},request.list),{},{params:params,rowKey:ID,actionRef:actionRef,columns:columns,pagination:{pageSize:10,simple:!0},search:!1,options:!1,toolbar:{search:search,menu:menu("全部","已添加")}},batch))},SelectChildrenSimple_excluded=["meta","fromRecord","title","cols","onChange","value"],SelectChildrenSimple=function(_ref){var meta=_ref.meta,fromRecord=_ref.fromRecord,cols=(_ref.title,_ref.cols),onChange=_ref.onChange,value=_ref.value,props=Object(objectWithoutProperties.a)(_ref,SelectChildrenSimple_excluded),_useJoinTableAction=join_table_useJoinTableAction(meta,fromRecord),add=_useJoinTableAction.add,del=_useJoinTableAction.del,key=meta.to.key,list=function useQueryList(table){var params=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},pg=ClientContext_useClient().pg,_useQuery=Object(useQuery.a)([[table],table,params],Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(){var query,_yield$query,data;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!Object(lodash.some)(params,lodash.isUndefined)){_context2.next=2;break}return _context2.abrupt("return",[]);case 2:return query=pg.from(table).select(),Object(lodash.each)(params,(function(v,k){return query.eq(k,v)})),_context2.next=6,query;case 6:return _yield$query=_context2.sent,data=_yield$query.data,_context2.abrupt("return",data);case 9:case"end":return _context2.stop()}}),_callee2)}))),Object(objectSpread2.a)({staleTime:1/0},options)),isLoading=_useQuery.isLoading,data=_useQuery.data;return isLoading?[]:data}(meta.to.table),options=list.map((function(item){return{value:item[key],label:item[cols[0]]}})),onSelect=function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(val){var child;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return child=Object(lodash.find)(list,[key,val]),_context.next=3,add(child);case 3:onChange&&onChange(Object(lodash.unionBy)(value,[child],key));case 4:case"end":return _context.stop()}}),_callee)})));return function onSelect(_x){return _ref2.apply(this,arguments)}}(),onDeselect=function(){var _ref3=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(val){var child;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return child=Object(lodash.find)(list,[key,val]),_context2.next=3,del(child);case 3:onChange&&onChange(Object(lodash.differenceBy)(value,[child],key));case 4:case"end":return _context2.stop()}}),_callee2)})));return function onDeselect(_x2){return _ref3.apply(this,arguments)}}();return Object(jsx_runtime.jsx)(es_select.a,Object(objectSpread2.a)({mode:"multiple",value:Object(lodash.map)(value,key),options:options,placeholder:"请选择",optionFilterProp:"label",onSelect:onSelect,onDeselect:onDeselect},props))},JoinEdit_excluded=["manageable"],JoinEdit_JoinEdit=function JoinEdit(_ref){var manageable=_ref.manageable,props=Object(objectWithoutProperties.a)(_ref,JoinEdit_excluded);return Object(jsx_runtime.jsxs)(pro_card_es.a,{ghost:!0,children:[Object(jsx_runtime.jsx)(pro_card_es.a,{colSpan:8,children:Object(jsx_runtime.jsxs)(space.b,{style:{width:"100%"},size:"large",direction:"vertical",children:[Object(jsx_runtime.jsx)(Dialog_Dialog,{trigger:Object(jsx_runtime.jsx)(es_button.a,{children:"选取"}),children:Object(jsx_runtime.jsx)(SelectChildren,Object(objectSpread2.a)({},props))}),manageable&&Object(jsx_runtime.jsx)(Dialog_Dialog,{trigger:"设置",children:Object(jsx_runtime.jsx)(JoinTable_JoinTable,Object(objectSpread2.a)({editable:!0},props))}),props.value&&(props.value.length>5?Object(jsx_runtime.jsx)(typography.a.Text,{type:"secondary",children:"超过 5 项， 请使用选取功能"}):Object(jsx_runtime.jsx)(SelectChildrenSimple,Object(objectSpread2.a)({},props))),Object(jsx_runtime.jsx)(es_alert.a,{type:"info",showIcon:!0,message:"此处操作会直接修改数据库"})]})}),Object(jsx_runtime.jsx)(pro_card_es.a,{ghost:!0,children:Object(jsx_runtime.jsx)(StaticTable_StaticTable,{table:props.meta.to.table,value:props.value,cols:props.cols,plain:!0})})]})};JoinEdit_JoinEdit.__docgenInfo={description:"edit join table",methods:[],displayName:"JoinEdit",props:{manageable:{required:!0,tsType:{name:"boolean"},description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\schema\\join-table\\join-by\\JoinEdit.tsx"]={name:"JoinEdit",docgenInfo:JoinEdit_JoinEdit.__docgenInfo,path:"src\\core\\schema\\join-table\\join-by\\JoinEdit.tsx"});var JoinShow_excluded=["value","meta"],JoinShow_JoinShow=function JoinShow(_ref){var value=_ref.value,meta=_ref.meta,props=Object(objectWithoutProperties.a)(_ref,JoinShow_excluded),showMore=value.length>5,getDefaultCols=useGetDefaultCols_useGetDefaultCols();return Object(jsx_runtime.jsxs)(space.b,{wrap:!0,children:[null==value?void 0:value.slice(0,showMore?4:5).map((function(item){return Object(jsx_runtime.jsx)(DrawerDesc_DrawerDesc,{table:meta.to.table,id:item[meta.to.key],entity:item,children:item[props.cols[0]]},item[meta.to.key])})),showMore&&Object(jsx_runtime.jsx)(Dialog_Dialog,{trigger:Object(jsx_runtime.jsxs)("span",{children:["...",Object(jsx_runtime.jsx)(BadgeNumber_BadgeNumber,{num:value.length})]}),children:Object(jsx_runtime.jsx)(StaticTable_StaticTable,{table:meta.to.table,value:value,cols:props.cols,subTitle:props.fromRecord[getDefaultCols(meta.from.table)[0]]})})]})};JoinShow_JoinShow.__docgenInfo={description:"show join info",methods:[],displayName:"JoinShow"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\schema\\join-table\\join-by\\JoinShow.tsx"]={name:"JoinShow",docgenInfo:JoinShow_JoinShow.__docgenInfo,path:"src\\core\\schema\\join-table\\join-by\\JoinShow.tsx"});var join_by_addJoinBy=function addJoinBy(draft){var meta=useTableMeta_useMeta(),getDefaultCols=useGetDefaultCols_useGetDefaultCols();Object(lodash.each)(draft.columns,(function(item){if(function isJoinBy(column){return Object(lodash.startsWith)(column.dataIndex.toString(),"joinby__")}(item)){var name=item.dataIndex.toString(),joinByTable=name.replace("joinby__",""),_meta$draft$name$join=meta[draft.name].joinBy[joinByTable],to=_meta$draft$name$join.to,table=(_meta$draft$name$join.by,to.table),tableMeta=meta[table],_item$cols=item.cols,cols=void 0===_item$cols?getDefaultCols(table):_item$cols,_item$manageable=item.manageable,manageable=void 0!==_item$manageable&&_item$manageable,_item$titleText=item.titleText,titleText=void 0===_item$titleText?tableMeta.tableDesc||table:_item$titleText,alias=name;draft.select="".concat(draft.select,",").concat(alias,":").concat(table,"!").concat(joinByTable,"(").concat(tableMeta.addKeys(cols).join(","),")"),draft.sort["".concat(alias,".").concat(tableMeta.keys[0])]="ascend",item._data={cols:cols,manageable:manageable,titleText:titleText}}}))},schemaData=function schemaData(schema){var _schema$originProps;return(null===(_schema$originProps=schema.originProps)||void 0===_schema$originProps?void 0:_schema$originProps._data)||(null==schema?void 0:schema._data)||{}},defaultTemplate={key:function key(column){return{editable:!1,_form:{readonly:!0},render:function render(dom,entity,index,action,schema){var val=entity[schema.dataIndex];return"form"===schema.type?Object(jsx_runtime.jsx)(Text_Text,{children:dom}):"descriptions"===schema.type?Object(jsx_runtime.jsx)(SchemaForm_Edit,{table:column.table,id:val}):Object(jsx_runtime.jsx)(DrawerDesc_DrawerDesc,{table:column.table,id:val,entity:entity,children:Object(jsx_runtime.jsx)(Text_Text,{underline:!0,children:val})})}}},array:valuetype_array,date:valuetype_date,boolean:valuetype_boolean,fulltextsearch:{_table:!1,editable:!1,_form:{readonly:!0}},join:function join(_ref){var name=_ref.name,fromTable=_ref.table,_name$replace$split3=name.replace("join__","").split("__"),_name$replace$split4=Object(slicedToArray.a)(_name$replace$split3,2),table=_name$replace$split4[0],field=_name$replace$split4[1],getDefaultCols=useGetDefaultCols_useGetDefaultCols(),meta=useTableMeta_useMeta();return{title:Object(jsx_runtime.jsx)(join_Text,{keyboard:!0,children:meta[table].tableDesc||table}),render:function render(val,record){return Object(jsx_runtime.jsx)(Dialog_Dialog,{trigger:Object(jsx_runtime.jsx)(BadgeNumber_BadgeNumber,{num:val.length}),children:Object(jsx_runtime.jsx)(table_LightTable,Object(objectSpread2.a)(Object(objectSpread2.a)({},schema_useSchema(table,Object(defineProperty.a)({},field,!1),{params:Object(defineProperty.a)({},field,record[meta[fromTable].keys.toString()])})),{},{subTitle:record[getDefaultCols(fromTable)[0]]}))})},editable:!1,_search:!1,_form:{renderFormItem:function renderFormItem(schema,config,form){return Object(jsx_runtime.jsx)(StaticTable_StaticTable,{value:config.value,table:table,plain:!0})}}}},joinBy:function joinBy(_ref,tableMeta){var _transform2,name=_ref.name,joinByMeta=tableMeta.joinBy[name.replace("joinby__","")],from=joinByMeta.from,to=joinByMeta.to,by=joinByMeta.by,pg=ClientContext_useClient().pg;return{title:function title(scheam,type,dom){var titleText=schemaData(scheam).titleText;return Object(jsx_runtime.jsx)(Text_Text,{keyboard:"table"===type,mark:"form"===type,children:titleText})},render:function render(value,record,index,action,schema){var _schemaData2=schemaData(schema),cols=_schemaData2.cols,titleText=_schemaData2.titleText;return Object(jsx_runtime.jsx)(JoinShow_JoinShow,{meta:joinByMeta,fromRecord:record,title:titleText,cols:cols,value:value})},editable:!1,_search:{renderFormItem:function renderFormItem(schema,config,form){var cols=schemaData(schema).cols;return Object(jsx_runtime.jsx)(SelectForeignTable_SelectForeignTable,{table:to.table,field:to.key,by:null==cols?void 0:cols[0],constraint:[by.table,by.toKey,null]})},_transform:(_transform2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(field,val,query){var result;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,pg.from(by.table).select(by.fromKey).eq(by.toKey,val);case 2:result=_context.sent.data,query.in(from.key,Object(lodash.map)(result,by.fromKey));case 4:case"end":return _context.stop()}}),_callee)}))),function _transform(_x,_x2,_x3){return _transform2.apply(this,arguments)})},_form:{renderFormItem:function renderFormItem(schema,config,form){var _schemaData4=schemaData(schema),cols=_schemaData4.cols,manageable=_schemaData4.manageable,titleText=_schemaData4.titleText;return Object(jsx_runtime.jsx)(JoinEdit_JoinEdit,{meta:joinByMeta,fromRecord:form.getFieldsValue(!0),manageable:manageable,title:titleText,cols:cols})}}}},embed:function embed(_ref2,_ref3){var table=_ref2.table,col=_ref2.name,name=_ref3.name,desc=_ref3.desc,cols=_ref3.cols;return{title:function title(_,type){return Object(jsx_runtime.jsx)(embed_EmbedTitle,{col:col,table:table,desc:desc,index:Object(lodash.indexOf)(cols,col),type:type})},render:function render(val,entity){return Object(jsx_runtime.jsx)(DrawerDesc_DrawerDesc,{table:table,id:entity[name],entity:entity,children:val})}}}},column_defaultSchema=function defaultSchema(column,tableMeta,params){var _config$schema,_config$schema$table,_config$options,_config$options$table,_config$baseColumns,_columnSchema$formIte,table=column.table,name=column.name,defaultValue=column.defaultValue,config=ClientContext_useClient().config,template=function useTemplate(){var config=ClientContext_useClient().config;return Object(react.useMemo)((function(){return new Proxy(defaultTemplate,{get:function get(target,prop){var _config$template2;return Object(lodash.isFunction)(target[prop])?function(){for(var _config$template,_config$template$prop,_len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Object(lodash.merge)(target[prop].apply(target,args),null===(_config$template=config.template)||void 0===_config$template||null===(_config$template$prop=_config$template[prop])||void 0===_config$template$prop?void 0:_config$template$prop.call.apply(_config$template$prop,[_config$template].concat(args)))}:Object(lodash.merge)(target[prop],null===(_config$template2=config.template)||void 0===_config$template2?void 0:_config$template2[prop])}})}),[config])}(),schemaDef=null===(_config$schema=config.schema)||void 0===_config$schema||null===(_config$schema$table=_config$schema[table])||void 0===_config$schema$table?void 0:_config$schema$table[name];Object(lodash.isFunction)(schemaDef)&&(schemaDef=schemaDef(column,tableMeta));var optionsDef=null===(_config$options=config.options)||void 0===_config$options||null===(_config$options$table=_config$options[table])||void 0===_config$options$table?void 0:_config$options$table[name],selectType={valueType:"select",filters:!0,onFilter:!0,_form:{width:"sm"}},configSchema=Object(lodash.defaultsDeep)({},schemaDef,optionsDef&&(Object(lodash.isArray)(optionsDef)?Object(objectSpread2.a)(Object(objectSpread2.a)({},selectType),{},{fieldProps:{options:optionsDef}}):Object(objectSpread2.a)(Object(objectSpread2.a)({},selectType),{},{valueEnum:optionsDef})),null===(_config$baseColumns=config.baseColumns)||void 0===_config$baseColumns?void 0:_config$baseColumns[name]),templateSchema=Object(lodash.defaultsDeep)({},column.isJoin&&template.join(column),column.isJoinBy&&template.joinBy(column,tableMeta),column.isEmbed&&template.embed(column,params),column.isKey&&template.key(column),column.isGenerated&&{editable:!1,_form:{readonly:!0}},column.isEnum&&Object(objectSpread2.a)(Object(objectSpread2.a)({},selectType),{},{fieldProps:{options:column.enums},initialValue:defaultValue&&defaultValue.split("'")[1],_search:{initialValue:null}}),column.isArray&&template.array,column.isDate&&template.date,column.isBoolean&&template.boolean(column),column.isNumber&&{valueType:"digit"},column.isText&&{valueType:"textarea"},column.isFullTextSearch&&template.fulltextsearch),columnSchema=Object(lodash.defaultsDeep)({dataIndex:name},configSchema,templateSchema,{title:column.desc||name,formItemProps:{rules:[]}}),rules=null===(_columnSchema$formIte=columnSchema.formItemProps)||void 0===_columnSchema$formIte?void 0:_columnSchema$formIte.rules;return rules.push.apply(rules,Object(toConsumableArray.a)(defaultRules(column))),columnSchema},defaultRules=function defaultRules(column){var rules=[];return"userDef"!==column.dataType&&!column.isNullable&&!column.isKey&&rules.push({required:!0,message:"此项为必填项"}),column.maxLength&&rules.push({max:column.maxLength,message:"最大字符数 "+column.maxLength}),rules},hide_hideColumns=function hideColumns(schema,_ref){var hide=_ref.hide,show=_ref.show;Object(lodash.chain)(null==schema?void 0:schema.table).groupBy("dataIndex").forEach((function(arr,dataIndex){Object(lodash.isString)(dataIndex)&&Object(lodash.isUndefined)(arr[0].key)&&(arr[0].key=dataIndex)})).value();var stateMap=lodash.assign.apply(void 0,[{}].concat(Object(toConsumableArray.a)((show&&Object(lodash.chain)(schema.table).map("dataIndex").compact().uniq().difference(show||[]).value()||hide||[]).map((function(item){return Object(defineProperty.a)({},item,{show:!1})}))))),_useState=Object(react.useState)(stateMap),_useState2=Object(slicedToArray.a)(_useState,2),columnsStateMap=_useState2[0],setColumnsStateMap=_useState2[1];return Object(lodash.forEach)(columnsStateMap,(function(item,key){var searchSchema=schema_getSearchSchema(schema,key.split(",")[0].replace("embed__",""));searchSchema&&(!1===item.show&&(searchSchema.hideInSearch=!0),"left"===item.fixed&&(searchSchema.order=1),"right"===item.fixed&&(searchSchema.order=-1))})),{columnsStateMap:columnsStateMap,onColumnsStateChange:setColumnsStateMap}},order_orderColumns=function orderColumns(schema,columnsStateMap){var hideInTable=function hideInTable(item){return!1===item._table||!0===item.hideInTable||function hideInState(item){var _columnsStateMap$cast;return!1===(null===(_columnsStateMap$cast=columnsStateMap[Object(lodash.castArray)(item.dataIndex).join(",")])||void 0===_columnsStateMap$cast?void 0:_columnsStateMap$cast.show)}(item)},tableColsLength=Object(lodash.filter)(schema.table,(function(item){return!hideInTable(item)})).length;schema.table=order_orderTableColumns(schema.table,tableColsLength,hideInTable);var _partition=Object(lodash.partition)(schema.table,hideInTable),_partition2=Object(slicedToArray.a)(_partition,2),searchColumns=_partition2[0],tableColumns=_partition2[1];Object(lodash.chain)(tableColumns).reverse().forEach((function(column,index){Object(lodash.chain)(Object(lodash.union)(schema.form,searchColumns)).filter((function(item){return order_isSameCol(item.dataIndex,column.dataIndex)})).forEach((function(item){Object(lodash.isUndefined)(item.order)&&(item.order=index+1)})).value()})).value()},order_orderTableColumns=function orderTableColumns(columns,tableColsLength,hideInTable){var _partition3=Object(lodash.partition)(columns,hideInTable),_partition4=Object(slicedToArray.a)(_partition3,2),hideColumns=_partition4[0],showColumns=_partition4[1],_partition5=Object(lodash.partition)(showColumns,(function(item){return Object(lodash.has)(item,"_order")})),_partition6=Object(slicedToArray.a)(_partition5,2),hasOrderColumns=_partition6[0],noOrderColumns=_partition6[1],target=new Array(columns.length);return Object(lodash.each)(hasOrderColumns,(function(column){var order=column._order,fromIndex=order<0?tableColsLength+order:order-1,location=Object(lodash.findIndex)(target,lodash.isUndefined,fromIndex);target[location]=column})),Object(lodash.each)(Object(lodash.union)(noOrderColumns,hideColumns),(function(column){return target[Object(lodash.findIndex)(target,lodash.isUndefined)]=column})),target},order_isSameCol=function isSameCol(a,b){var originalCol=function originalCol(dataIndex){return Object(lodash.castArray)(dataIndex)[0].replace("embed__","")};return originalCol(a)===originalCol(b)},schema_useSchema=function useSchema(name){var userDef=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_ref=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},cols=_ref.cols,_ref$type=_ref.type,type=void 0===_ref$type?"normal":_ref$type,_ref$join=_ref.join,join=void 0===_ref$join?{}:_ref$join,_ref$joinBy=_ref.joinBy,joinBy=void 0===_ref$joinBy?{}:_ref$joinBy,_ref$returnDraft=_ref.returnDraft,returnDraft=void 0!==_ref$returnDraft&&_ref$returnDraft,_ref$params=_ref.params,params=void 0===_ref$params?{}:_ref$params,hide=_ref.hide,show=_ref.show,_ref$addKeys=_ref.addKeys,addKeys=void 0===_ref$addKeys||_ref$addKeys,meta=useTableMeta(name),tableDesc=meta.tableDesc||name,getDefaultCols=useGetDefaultCols_useGetDefaultCols();if(Object(lodash.isEmpty)(cols)){if(Object(lodash.isUndefined)(cols)){var defaultShow=Object(lodash.union)(addKeys&&!returnDraft&&meta.keys,getDefaultCols(name),Object(lodash.keys)(userDef),meta.foreignKeys);defaultShow.length<4&&(defaultShow=Object(lodash.union)(defaultShow,meta.cols).slice(0,4)),hide=Object(lodash.union)(Object(lodash.difference)(meta.cols,defaultShow),hide)}cols=Object(lodash.union)(Object(lodash.keys)(userDef),meta.cols)}else cols=Object(lodash.union)(cols,Object(lodash.keys)(userDef));addKeys&&!returnDraft&&(cols=meta.addKeys(cols)),cols=Object(lodash.filter)(cols,(function(col){return!1!==userDef[col]}));var _join=Object(lodash.mapKeys)(join,(function(_,key){return"join__"+key})),_joinBy=Object(lodash.mapKeys)(joinBy,(function(_,key){return"joinby__"+key}));Object(lodash.defaultsDeep)(userDef,_join,_joinBy);var schema,draft={name:name,select:"*",id:meta.keys[0],isView:meta.isViewTable,sort:meta.isViewTable?{}:Object(defineProperty.a)({},meta.keys[0],"ascend"),columns:Object(lodash.map)(Object(lodash.union)(cols,Object(lodash.keys)(_join),Object(lodash.keys)(_joinBy)),(function(col){var column=Object(objectSpread2.a)(Object(objectSpread2.a)({},meta.getColumn(col)||{name:col,table:name,dataType:"userDef"}),{},{isJoin:Object(lodash.startsWith)(col,"join__"),isJoinBy:Object(lodash.startsWith)(col,"joinby__"),isEmbed:"embed"===type}),def=userDef[col];return Object(lodash.defaultsDeep)({dataIndex:col,_column:column},Object(lodash.isPlainObject)(def)?def:Object(lodash.isNumber)(def)?{_order:def}:{},column_defaultSchema(column,meta,params))}))};if(!0===returnDraft)return{draft:draft};join_addJoin(draft),join_by_addJoinBy(draft),"static"!==type&&embed_addEmbed(draft,params),schema=schema_toSchema(draft);var _hideColumns=hide_hideColumns(schema,{hide:Object(lodash.difference)(hide,show)}),columnsStateMap=_hideColumns.columnsStateMap,onColumnsStateChange=_hideColumns.onColumnsStateChange;return order_orderColumns(schema,columnsStateMap),{schema:schema,tableDesc:tableDesc,params:params,columnsStateMap:columnsStateMap,onColumnsStateChange:onColumnsStateChange}},SchemaForm_excluded=["name","onFinish","columns","record"],SchemaForm_SchemaForm=function SchemaForm(_ref){var name=_ref.name,onFinish=_ref.onFinish,columns=_ref.columns,record=_ref.record,props=Object(objectWithoutProperties.a)(_ref,SchemaForm_excluded),formRef=Object(react.useRef)();return Object(react.useEffect)((function(){var _formRef$current;null===(_formRef$current=formRef.current)||void 0===_formRef$current||_formRef$current.setFieldsValue(record)}),[record]),Object(jsx_runtime.jsx)(components_SchemaForm.a,Object(objectSpread2.a)({title:name,formRef:formRef,layoutType:"DrawerForm",onFinish:onFinish,columns:columns,trigger:Object(jsx_runtime.jsx)("a",{children:name}),omitNil:!1},props))},SchemaForm_Edit=function Edit(_ref2){var table=_ref2.table,id=_ref2.id,formRef=Object(react.useRef)(),_useSchema=schema_useSchema(table,{},{cols:[]}),schema=_useSchema.schema,tableDesc=_useSchema.tableDesc,_useQueryRequest=useQuery_useQueryRequest(schema),upsert=_useQueryRequest.upsert,_useQueryRequest$one=_useQueryRequest.one,dataSource=_useQueryRequest$one.dataSource,request=_useQueryRequest$one.request;return Object(react.useEffect)((function(){request(Object(defineProperty.a)({},schema.id,id))}),[]),Object(react.useEffect)((function(){var _formRef$current2;null===(_formRef$current2=formRef.current)||void 0===_formRef$current2||_formRef$current2.setFieldsValue(dataSource)}),[dataSource]),Object(jsx_runtime.jsx)(components_SchemaForm.a,{title:tableDesc||table,formRef:formRef,layoutType:"DrawerForm",onFinish:upsert,columns:schema.form,trigger:Object(jsx_runtime.jsxs)("a",{children:[id," ",Object(jsx_runtime.jsx)(EditOutlined.a,{})]}),omitNil:!1})};SchemaForm_SchemaForm.__docgenInfo={description:"",methods:[],displayName:"SchemaForm",props:{name:{required:!1,tsType:{name:"ReactNode"},description:""},record:{required:!1,tsType:{name:"signature",type:"object",raw:"{}",signature:{properties:[]}},description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\action\\SchemaForm.tsx"]={name:"SchemaForm",docgenInfo:SchemaForm_SchemaForm.__docgenInfo,path:"src\\core\\action\\SchemaForm.tsx"}),SchemaForm_Edit.__docgenInfo={description:"",methods:[],displayName:"Edit"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\action\\SchemaForm.tsx"]={name:"Edit",docgenInfo:SchemaForm_Edit.__docgenInfo,path:"src\\core\\action\\SchemaForm.tsx"});var useAction_excluded=["action","children"],useAction_excluded2=["initialValues"],_excluded3=["name","set","form","fun","funs","relaod","hide","show"],_excluded4=["form","button"],_excluded5=["form","button"],useAction_useAction=function useAction(_ref){var _onDelete,_onSave,schema=_ref.schema,actionRef=_ref.actionRef,_ref$operates=_ref.operates,operates=void 0===_ref$operates?[]:_ref$operates,request=useQuery_useQueryRequest(schema,actionRef),ID=schema.id,sumbit=function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(formData){var _actionRef$current;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,request.upsert(formData);case 2:return null===(_actionRef$current=actionRef.current)||void 0===_actionRef$current||_actionRef$current.reload(),_context.abrupt("return",!0);case 4:case"end":return _context.stop()}}),_callee)})));return function sumbit(_x){return _ref2.apply(this,arguments)}}(),Action=function Action(_ref3){var action=_ref3.action,children=_ref3.children,props=Object(objectWithoutProperties.a)(_ref3,useAction_excluded);return Object(jsx_runtime.jsx)(Button_ActionButton,Object(objectSpread2.a)(Object(objectSpread2.a)({action:Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(){var _actionRef$current2;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,action();case 2:null===(_actionRef$current2=actionRef.current)||void 0===_actionRef$current2||_actionRef$current2.reload();case 3:case"end":return _context2.stop()}}),_callee2)})))},props),{},{children:children}))},omitTempId=function omitTempId(row){return Object(lodash.isNumber)(row[ID])&&row[ID]<1||!row[ID]?Object(lodash.omit)(row,ID):row},editable={onSave:(_onSave=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(key,row){var newData,result;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(newData=Object(lodash.omit)(row,"index"),!(newData=omitTempId(newData))[ID]){_context3.next=6;break}request.update(newData),_context3.next=10;break;case 6:return _context3.next=8,request.upsert(newData);case 8:result=_context3.sent,row[ID]=null==result?void 0:result[ID];case 10:case"end":return _context3.stop()}}),_callee3)}))),function onSave(_x2,_x3){return _onSave.apply(this,arguments)}),onDelete:(_onDelete=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(key,row){return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",request.delete(row));case 1:case"end":return _context4.stop()}}),_callee4)}))),function onDelete(_x4,_x5){return _onDelete.apply(this,arguments)})},_groupOperates=function groupOperates(operates,schema){var group={defaultOpers:[],userOpers:[],operOption:{}};return null==operates||operates.forEach((function(oper){if(Object(lodash.isString)(oper))group.defaultOpers.push(oper);else if("name"in oper){var form=oper.form,props=Object(objectWithoutProperties.a)(oper,operate_excluded);group.userOpers.push(form?Object(objectSpread2.a)(Object(objectSpread2.a)({},props),{},{form:Object(lodash.flatten)(Object(lodash.map)(oper.form,(function(item){return Object(lodash.isString)(item)?Object(lodash.filter)(schema.form,["dataIndex",item]):item})))}):props)}else group.operOption=oper})),group}(operates,schema),defaultOpers=_groupOperates.defaultOpers,userOpers=_groupOperates.userOpers,operOption=_groupOperates.operOption,actionOpers=function actionOpers(records,ids){var singleRecord=records.length>1?null:records[0];return userOpers.filter((function(_ref6){var hide=_ref6.hide,show=_ref6.show,fun=_ref6.fun,funs=_ref6.funs;return!(hide&&Object(lodash.every)(records,hide)||show&&Object(lodash.every)(records,(function(record){return!show(record)})))&&!(!singleRecord&&fun&&!funs)})).map((function(_ref7){var name=_ref7.name,set=_ref7.set,form=_ref7.form,fun=_ref7.fun,funs=_ref7.funs,relaod=_ref7.relaod,other=(_ref7.hide,_ref7.show,Object(objectWithoutProperties.a)(_ref7,_excluded3)),action=function(){var _ref8=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee5(data){var _actionRef$current3,_actionRef$current4;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!set&&!form){_context5.next=5;break}return _context5.next=3,singleRecord?request.upsert(Object(objectSpread2.a)(Object(objectSpread2.a)({},singleRecord),data||set)):request.batchUpdate(ids,data||set);case 3:_context5.next=11;break;case 5:if(!fun||!singleRecord){_context5.next=8;break}return _context5.next=8,fun(singleRecord,request);case 8:if(!funs){_context5.next=11;break}return _context5.next=11,funs(records,request);case 11:return!1!==relaod&&(null===(_actionRef$current3=actionRef.current)||void 0===_actionRef$current3||_actionRef$current3.reload()),(null===(_actionRef$current4=actionRef.current)||void 0===_actionRef$current4?void 0:_actionRef$current4.clearSelected)&&actionRef.current.clearSelected(),_context5.abrupt("return",!0);case 14:case"end":return _context5.stop()}}),_callee5)})));return function action(_x6){return _ref8.apply(this,arguments)}}();return Object(objectSpread2.a)({key:name,name:name,action:action,form:form,disabled:set&&Object(lodash.every)(records,Object(lodash.matches)(set))},other)}))},batch={rowSelection:{selections:[es_table.a.SELECTION_INVERT]},tableAlertRender:function tableAlertRender(_ref11){var selectedRowKeys=_ref11.selectedRowKeys,selectedRows=_ref11.selectedRows,onCleanSelected=_ref11.onCleanSelected,opers=actionOpers(selectedRows,selectedRowKeys);return Object(jsx_runtime.jsxs)(space.b,{size:24,children:[Object(jsx_runtime.jsxs)(space.b,{size:16,children:[Object(jsx_runtime.jsx)("a",{onClick:onCleanSelected,children:"取消选择"}),Object(jsx_runtime.jsxs)("span",{children:["已选 ",selectedRowKeys.length," 项"]})]}),Object(jsx_runtime.jsx)(space.b,{size:16,children:opers.map((function(_ref12,index){var form=_ref12.form,button=_ref12.button,props=Object(objectWithoutProperties.a)(_ref12,_excluded5);return form?Object(jsx_runtime.jsx)(components_SchemaForm.a,{layoutType:"ModalForm",onFinish:props.action,columns:form,trigger:Object(jsx_runtime.jsx)("a",{children:props.name})},index):Object(jsx_runtime.jsx)(Button_ActionButton,Object(objectSpread2.a)(Object(objectSpread2.a)({type:0===index?"primary":"ghost"},button),props))}))})]})},tableAlertOptionRender:function tableAlertOptionRender(_ref13){var selectedRowKeys=_ref13.selectedRowKeys;return!1!==operOption.batchDelete&&Object(jsx_runtime.jsx)(Action,{danger:!0,type:"primary",action:Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee6(){var _actionRef$current5,_actionRef$current6;return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,request.batchDel(selectedRowKeys);case 2:(null===(_actionRef$current5=actionRef.current)||void 0===_actionRef$current5?void 0:_actionRef$current5.clearSelected)&&(null===(_actionRef$current6=actionRef.current)||void 0===_actionRef$current6||_actionRef$current6.clearSelected);case 3:case"end":return _context6.stop()}}),_callee6)}))),children:"删除"})}},testOnly={expandedRowRender:function expandedRowRender(record,index){return Object(jsx_runtime.jsx)(SchemaForm_SchemaForm,{key:"edit",name:"编辑",columns:schema.form,onFinish:sumbit,record:record,layoutType:"Form"})}},columns=Object(toConsumableArray.a)(schema.table);return operates.length>0&&columns.push({title:"操作",valueType:"option",render:function renderOperates(text,record,index,action){var _operOption$maxInRow,LINKS_NUM=null!==(_operOption$maxInRow=operOption.maxInRow)&&void 0!==_operOption$maxInRow?_operOption$maxInRow:2,opers=actionOpers([record],[record[ID]]).filter((function(_ref9){var form=_ref9.form,showInRow=_ref9.showInRow;return!form||showInRow})),menu=opers.splice(LINKS_NUM);return[].concat(Object(toConsumableArray.a)(defaultOpers.map((function(item){return"inline_edit"===item?Object(jsx_runtime.jsx)("a",{onClick:function onClick(){var _action$startEditable;null==action||null===(_action$startEditable=action.startEditable)||void 0===_action$startEditable||_action$startEditable.call(action,record[ID])},children:Object(jsx_runtime.jsx)(EditOutlined.a,{})},"inline_edit"):"edit"===item?Object(jsx_runtime.jsx)(SchemaForm_SchemaForm,{key:"edit",name:"编辑",columns:schema.form,onFinish:sumbit,record:record}):null}))),Object(toConsumableArray.a)(opers.map((function(_ref10){var form=_ref10.form,button=_ref10.button,props=Object(objectWithoutProperties.a)(_ref10,_excluded4);return form?Object(jsx_runtime.jsx)(components_SchemaForm.a,{layoutType:"ModalForm",onFinish:props.action,columns:form,trigger:Object(jsx_runtime.jsx)("a",{children:props.name})}):Object(jsx_runtime.jsx)(Button_Link,Object(objectSpread2.a)(Object(objectSpread2.a)({},button),props))}))),[menu.length>0&&Object(jsx_runtime.jsx)(Button_LinkMenu,{menu:menu},"menu")])}}),{request:request,Action:Action,Create:defaultOpers.includes("create")?function Create(_ref5){var _ref5$initialValues=_ref5.initialValues,initialValues=void 0===_ref5$initialValues?{}:_ref5$initialValues,props=Object(objectWithoutProperties.a)(_ref5,useAction_excluded2);return Object(jsx_runtime.jsx)(components_SchemaForm.a,Object(objectSpread2.a)({title:"新建",layoutType:"ModalForm",onFinish:sumbit,columns:schema.form,initialValues:initialValues,trigger:Object(jsx_runtime.jsx)(es_button.a,{icon:Object(jsx_runtime.jsx)(PlusOutlined.a,{}),type:"primary",children:"新建"})},props))}:function(){return Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{})},editable:editable,columns:columns,batch:batch,tempId:function tempId(){return Object(lodash.random)(0,1,!0)},ID:ID,testOnly:testOnly}},table_excluded=["schema","tableDesc","operates","testKey"],table_Table=function Table(_ref){var schema=_ref.schema,tableDesc=_ref.tableDesc,operates=_ref.operates,testKey=_ref.testKey,props=Object(objectWithoutProperties.a)(_ref,table_excluded),actionRef=Object(react.useRef)(),_useAction=useAction_useAction({schema:schema,actionRef:actionRef,operates:operates||(schema.isView?[]:["create","inline_edit","edit"])}),request=_useAction.request,columns=_useAction.columns,Create=_useAction.Create,editable=_useAction.editable,batch=_useAction.batch,ID=_useAction.ID,testOnly=_useAction.testOnly;return Object(jsx_runtime.jsx)(es.a,Object(objectSpread2.a)(Object(objectSpread2.a)(Object(objectSpread2.a)({},request.list),{},{columns:columns,actionRef:actionRef,editable:editable,rowKey:ID||function(_,index){return index},search:{labelWidth:"auto",defaultCollapsed:!0},form:{syncToUrl:!1},pagination:{pageSize:5},dateFormatter:"string",headerTitle:tableDesc||schema.name},schema.isView?{}:Object(objectSpread2.a)({toolBarRender:function toolBarRender(){return[!schema.isView&&Object(jsx_runtime.jsx)(Create,{})]}},batch)),{},{expandable:testKey&&Object(objectSpread2.a)({defaultExpandedRowKeys:[testKey]},testOnly)},props))};table_Table.__docgenInfo={description:"",methods:[],displayName:"Table",props:{schema:{required:!0,tsType:{name:"Schema"},description:""},tableDesc:{required:!1,tsType:{name:"string"},description:""},operates:{required:!1,tsType:{name:"Array",elements:[{name:"Operate",elements:[{name:"T"}],raw:"Operate<T>"}],raw:"Operate<T>[]"},description:""},testKey:{required:!1,tsType:{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]},description:""}}};var ui_table=table_Table;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\table\\index.tsx"]={name:"Table",docgenInfo:table_Table.__docgenInfo,path:"src\\core\\ui\\table\\index.tsx"});var SelectField_excluded=["table","field"],SelectField_SelectField=function SelectField(_ref){var table=_ref.table,field=_ref.field,props=Object(objectWithoutProperties.a)(_ref,SelectField_excluded),rpc=rpc_useRPC();return Object(jsx_runtime.jsx)(Select_SelectBase,Object(objectSpread2.a)({request:function request(){return rpc("select",{table:table,field:field})}},props))};SelectField_SelectField.__docgenInfo={description:"",methods:[],displayName:"SelectField"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\core\\ui\\select\\SelectField.tsx"]={name:"SelectField",docgenInfo:SelectField_SelectField.__docgenInfo,path:"src\\core\\ui\\select\\SelectField.tsx"});var search_select_selectColumn=function selectColumn(_ref){var table=_ref.table,name=_ref.name;return{renderFormItem:function renderFormItem(schema,config,form){return Object(jsx_runtime.jsx)(SelectField_SelectField,{table:table,field:name})}}},dist_module=__webpack_require__(211),supabase_js_dist_module=__webpack_require__(547),core_queryClient=__webpack_require__(1322),notification=__webpack_require__(745),processResult_processResult=function processResult(_ref){var data=_ref.data,error=_ref.error,count=_ref.count;if(error)throw notification.a.error({message:"".concat(error.code,"：").concat(error.message),description:error.hint}),Error(error.message);return{data:data,error:error,count:count,success:!error,total:count,errorCode:null==error?void 0:error.code,errorMessage:null==error?void 0:error.message}},originThen=dist_module.b.prototype.then;dist_module.b.prototype.then=function(resolve,reject){return originThen.call(this,processResult_processResult).then(resolve,reject)};var input_number=__webpack_require__(188),client_client=function initClient(_ref){var pg,pg_base,supabase,supabase_base,API_URL=_ref.API_URL,API_KEY=_ref.API_KEY,_ref$subscribe=_ref.subscribe,subscribe=void 0!==_ref$subscribe&&_ref$subscribe,_ref$staticMeta=_ref.staticMeta,staticMeta=void 0===_ref$staticMeta?{}:_ref$staticMeta,_ref$config=_ref.config,config=void 0===_ref$config?{}:_ref$config,_ref$baseSchema=_ref.baseSchema,baseSchema=void 0===_ref$baseSchema?"base":_ref$baseSchema;API_KEY?(pg=supabase=Object(supabase_js_dist_module.a)(API_URL,API_KEY),pg_base=supabase_base=Object(supabase_js_dist_module.a)(API_URL,API_KEY,{schema:baseSchema})):(pg=new dist_module.a(API_URL),pg_base=new dist_module.a(API_URL,{schema:baseSchema}));var queryClient=new core_queryClient.a({defaultOptions:{queries:{staleTime:1/0}}});return subscribe&&supabase.from("*").on("*",(function(payload){console.log("".concat(payload.table," ").concat(payload.eventType)),useQuery_invalidateQueries(queryClient,payload.table)})).subscribe((function(){return console.log("subscribe")})),subscribe&&supabase_base.from("ddl_command").on("INSERT",(function(payload){console.log("ddl command ".concat(payload.new.command_tag)),queryClient.invalidateQueries("db-meta")})).subscribe((function(){return console.log("subscribe meta")})),{pg:pg,pg_base:pg_base,queryClient:queryClient,supabase:supabase,supabase_base:supabase_base,staticMeta:staticMeta,config:config}}({API_URL:"https://cbmshxrvuxsehuosfqjb.supabase.co",API_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyMjAwMzQ3NiwiZXhwIjoxOTM3NTc5NDc2fQ.FphzuUbMo77xwZ8DCXcj5XNDaqYyD7k-6lbtTNvJNNA",staticMeta:{actor:{isViewTable:!1,tableDesc:null,keys:["actor_id"],foreignKeys:[],cols:["actor_id","first_name","last_name","last_update","fullname"],columns:[{name:"actor_id",table:"actor",dataType:"integer",defaultValue:"nextval('actor_actor_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"first_name",table:"actor",dataType:"character varying",maxLength:45,isVarChar:!0,isTextType:!0},{name:"last_name",table:"actor",dataType:"character varying",maxLength:45,isVarChar:!0,isTextType:!0},{name:"last_update",table:"actor",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0},{name:"fullname",table:"actor",dataType:"character varying",isNullable:!0,maxLength:90,isVarChar:!0,isTextType:!0,isGenerated:!0}],embed:{},joinBy:{film_actor:{from:{table:"actor",key:"actor_id"},by:{table:"film_actor",fromKey:"actor_id",toKey:"film_id"},to:{table:"film",key:"film_id"}}},join:{film_actor__actor_id:{from:{table:"actor",key:"actor_id"},to:{table:"film_actor",field:"actor_id"}}}},actor_info:{isViewTable:!0,tableDesc:null,keys:[],foreignKeys:[],cols:["actor_id","first_name","last_name","film_info"],columns:[{name:"actor_id",table:"actor_info",dataType:"integer",isNullable:!0,isNumber:!0},{name:"first_name",table:"actor_info",dataType:"character varying",isNullable:!0,maxLength:45,isVarChar:!0,isTextType:!0},{name:"last_name",table:"actor_info",dataType:"character varying",isNullable:!0,maxLength:45,isVarChar:!0,isTextType:!0},{name:"film_info",table:"actor_info",dataType:"text",isNullable:!0,isText:!0,isTextType:!0}],embed:{},joinBy:{},join:{}},address:{isViewTable:!1,tableDesc:null,keys:["address_id"],foreignKeys:["city_id"],cols:["address_id","address","address2","district","city_id","postal_code","phone","last_update"],columns:[{name:"address_id",table:"address",dataType:"integer",defaultValue:"nextval('address_address_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"address",table:"address",dataType:"character varying",maxLength:50,isVarChar:!0,isTextType:!0},{name:"address2",table:"address",dataType:"character varying",isNullable:!0,maxLength:50,isVarChar:!0,isTextType:!0},{name:"district",table:"address",dataType:"character varying",maxLength:20,isVarChar:!0,isTextType:!0},{name:"city_id",table:"address",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"postal_code",table:"address",dataType:"character varying",isNullable:!0,maxLength:10,isVarChar:!0,isTextType:!0},{name:"phone",table:"address",dataType:"character varying",maxLength:20,isVarChar:!0,isTextType:!0},{name:"last_update",table:"address",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0}],embed:{city_id:{from:{table:"address",field:"city_id"},to:{table:"city",key:"city_id"},constraint:"fk_address_city"}},joinBy:{store:{from:{table:"address",key:"address_id"},by:{table:"store",fromKey:"address_id",toKey:"manager_staff_id"},to:{table:"staff",key:"staff_id"}}},join:{customer__address_id:{from:{table:"address",key:"address_id"},to:{table:"customer",field:"address_id"}},staff__address_id:{from:{table:"address",key:"address_id"},to:{table:"staff",field:"address_id"}},store__address_id:{from:{table:"address",key:"address_id"},to:{table:"store",field:"address_id"}}}},category:{isViewTable:!1,tableDesc:null,keys:["category_id"],foreignKeys:[],cols:["category_id","name","last_update"],columns:[{name:"category_id",table:"category",dataType:"integer",defaultValue:"nextval('category_category_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"name",table:"category",dataType:"character varying",maxLength:25,isVarChar:!0,isTextType:!0},{name:"last_update",table:"category",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0}],embed:{},joinBy:{film_category:{from:{table:"category",key:"category_id"},by:{table:"film_category",fromKey:"category_id",toKey:"film_id"},to:{table:"film",key:"film_id"}}},join:{film_category__category_id:{from:{table:"category",key:"category_id"},to:{table:"film_category",field:"category_id"}}}},city:{isViewTable:!1,tableDesc:null,keys:["city_id"],foreignKeys:["country_id"],cols:["city_id","city","country_id","last_update"],columns:[{name:"city_id",table:"city",dataType:"integer",defaultValue:"nextval('city_city_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"city",table:"city",dataType:"character varying",maxLength:50,isVarChar:!0,isTextType:!0},{name:"country_id",table:"city",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"last_update",table:"city",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0}],embed:{country_id:{from:{table:"city",field:"country_id"},to:{table:"country",key:"country_id"},constraint:"fk_city"}},joinBy:{},join:{address__city_id:{from:{table:"city",key:"city_id"},to:{table:"address",field:"city_id"}}}},country:{isViewTable:!1,tableDesc:null,keys:["country_id"],foreignKeys:[],cols:["country_id","country","last_update"],columns:[{name:"country_id",table:"country",dataType:"integer",defaultValue:"nextval('country_country_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"country",table:"country",dataType:"character varying",maxLength:50,isVarChar:!0,isTextType:!0},{name:"last_update",table:"country",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0}],embed:{},joinBy:{},join:{city__country_id:{from:{table:"country",key:"country_id"},to:{table:"city",field:"country_id"}}}},customer:{isViewTable:!1,tableDesc:null,keys:["customer_id"],foreignKeys:["address_id"],cols:["customer_id","store_id","first_name","last_name","email","address_id","activebool","create_date","last_update","active"],columns:[{name:"customer_id",table:"customer",dataType:"integer",defaultValue:"nextval('customer_customer_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"store_id",table:"customer",dataType:"smallint",isNumber:!0},{name:"first_name",table:"customer",dataType:"character varying",maxLength:45,isVarChar:!0,isTextType:!0},{name:"last_name",table:"customer",dataType:"character varying",maxLength:45,isVarChar:!0,isTextType:!0},{name:"email",table:"customer",dataType:"character varying",isNullable:!0,maxLength:50,isVarChar:!0,isTextType:!0},{name:"address_id",table:"customer",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"activebool",table:"customer",dataType:"boolean",defaultValue:"true",isBoolean:!0},{name:"create_date",table:"customer",dataType:"date",defaultValue:"('now'::text)::date"},{name:"last_update",table:"customer",dataType:"timestamp without time zone",defaultValue:"now()",isNullable:!0,isDate:!0},{name:"active",table:"customer",dataType:"integer",isNullable:!0,isNumber:!0}],embed:{address_id:{from:{table:"customer",field:"address_id"},to:{table:"address",key:"address_id"},constraint:"customer_address_id_fkey"}},joinBy:{},join:{payment__customer_id:{from:{table:"customer",key:"customer_id"},to:{table:"payment",field:"customer_id"}},rental__customer_id:{from:{table:"customer",key:"customer_id"},to:{table:"rental",field:"customer_id"}}}},customer_list:{isViewTable:!0,tableDesc:null,keys:[],foreignKeys:[],cols:["id","name","address","zip code","phone","city","country","notes","sid"],columns:[{name:"id",table:"customer_list",dataType:"integer",isNullable:!0,isNumber:!0},{name:"name",table:"customer_list",dataType:"text",isNullable:!0,isText:!0,isTextType:!0},{name:"address",table:"customer_list",dataType:"character varying",isNullable:!0,maxLength:50,isVarChar:!0,isTextType:!0},{name:"zip code",table:"customer_list",dataType:"character varying",isNullable:!0,maxLength:10,isVarChar:!0,isTextType:!0},{name:"phone",table:"customer_list",dataType:"character varying",isNullable:!0,maxLength:20,isVarChar:!0,isTextType:!0},{name:"city",table:"customer_list",dataType:"character varying",isNullable:!0,maxLength:50,isVarChar:!0,isTextType:!0},{name:"country",table:"customer_list",dataType:"character varying",isNullable:!0,maxLength:50,isVarChar:!0,isTextType:!0},{name:"notes",table:"customer_list",dataType:"text",isNullable:!0,isText:!0,isTextType:!0},{name:"sid",table:"customer_list",dataType:"smallint",isNullable:!0,isNumber:!0}],embed:{},joinBy:{},join:{}},film:{isViewTable:!1,tableDesc:null,keys:["film_id"],foreignKeys:["language_id"],cols:["film_id","title","description","release_year","language_id","rental_duration","rental_rate","length","replacement_cost","rating","last_update","special_features","fulltext"],columns:[{name:"film_id",table:"film",dataType:"integer",defaultValue:"nextval('film_film_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"title",table:"film",desc:"名称",dataType:"character varying",maxLength:255,isVarChar:!0,isTextType:!0},{name:"description",table:"film",dataType:"text",isNullable:!0,isText:!0,isTextType:!0},{name:"release_year",table:"film",desc:"发布年份",dataType:"integer",isNullable:!0,isNumber:!0},{name:"language_id",table:"film",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"rental_duration",table:"film",dataType:"smallint",defaultValue:"3",isNumber:!0},{name:"rental_rate",table:"film",dataType:"numeric",defaultValue:"4.99",isNumber:!0},{name:"length",table:"film",dataType:"smallint",isNullable:!0,isNumber:!0},{name:"replacement_cost",table:"film",dataType:"numeric",defaultValue:"19.99",isNumber:!0},{name:"rating",table:"film",dataType:"USER-DEFINED",defaultValue:"'G'::mpaa_rating",isNullable:!0,enums:["G","PG","PG-13","R","NC-17"],isEnum:!0},{name:"last_update",table:"film",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0},{name:"special_features",table:"film",dataType:"ARRAY",isNullable:!0,isArray:!0},{name:"fulltext",table:"film",dataType:"tsvector",isFullTextSearch:!0}],embed:{language_id:{from:{table:"film",field:"language_id"},to:{table:"language",key:"language_id"},constraint:"film_language_id_fkey"}},joinBy:{film_actor:{from:{table:"film",key:"film_id"},by:{table:"film_actor",fromKey:"film_id",toKey:"actor_id"},to:{table:"actor",key:"actor_id"}},film_category:{from:{table:"film",key:"film_id"},by:{table:"film_category",fromKey:"film_id",toKey:"category_id"},to:{table:"category",key:"category_id"}},inventory:{from:{table:"film",key:"film_id"},by:{table:"inventory",fromKey:"film_id",toKey:"store_id"},to:{table:"store",key:"store_id"}}},join:{film_actor__film_id:{from:{table:"film",key:"film_id"},to:{table:"film_actor",field:"film_id"}},film_category__film_id:{from:{table:"film",key:"film_id"},to:{table:"film_category",field:"film_id"}},inventory__film_id:{from:{table:"film",key:"film_id"},to:{table:"inventory",field:"film_id"}}}},film_actor:{isViewTable:!1,tableDesc:null,keys:["actor_id","film_id"],foreignKeys:["actor_id","film_id"],cols:["actor_id","film_id","last_update"],columns:[{name:"actor_id",table:"film_actor",dataType:"smallint",isNumber:!0,isKey:!0,isForeignKey:!0},{name:"film_id",table:"film_actor",dataType:"smallint",isNumber:!0,isKey:!0,isForeignKey:!0},{name:"last_update",table:"film_actor",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0}],embed:{actor_id:{from:{table:"film_actor",field:"actor_id"},to:{table:"actor",key:"actor_id"},constraint:"film_actor_actor_id_fkey"},film_id:{from:{table:"film_actor",field:"film_id"},to:{table:"film",key:"film_id"},constraint:"film_actor_film_id_fkey"}},joinBy:{},join:{}},film_category:{isViewTable:!1,tableDesc:null,keys:["film_id","category_id"],foreignKeys:["category_id","film_id"],cols:["film_id","category_id","last_update"],columns:[{name:"film_id",table:"film_category",dataType:"smallint",isNumber:!0,isKey:!0,isForeignKey:!0},{name:"category_id",table:"film_category",dataType:"smallint",isNumber:!0,isKey:!0,isForeignKey:!0},{name:"last_update",table:"film_category",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0}],embed:{category_id:{from:{table:"film_category",field:"category_id"},to:{table:"category",key:"category_id"},constraint:"film_category_category_id_fkey"},film_id:{from:{table:"film_category",field:"film_id"},to:{table:"film",key:"film_id"},constraint:"film_category_film_id_fkey"}},joinBy:{},join:{}},film_list:{isViewTable:!0,tableDesc:null,keys:[],foreignKeys:[],cols:["fid","title","description","category","price","length","rating","actors"],columns:[{name:"fid",table:"film_list",dataType:"integer",isNullable:!0,isNumber:!0},{name:"title",table:"film_list",dataType:"character varying",isNullable:!0,maxLength:255,isVarChar:!0,isTextType:!0},{name:"description",table:"film_list",dataType:"text",isNullable:!0,isText:!0,isTextType:!0},{name:"category",table:"film_list",dataType:"character varying",isNullable:!0,maxLength:25,isVarChar:!0,isTextType:!0},{name:"price",table:"film_list",dataType:"numeric",isNullable:!0,isNumber:!0},{name:"length",table:"film_list",dataType:"smallint",isNullable:!0,isNumber:!0},{name:"rating",table:"film_list",dataType:"USER-DEFINED",isNullable:!0,enums:["G","PG","PG-13","R","NC-17"],isEnum:!0},{name:"actors",table:"film_list",dataType:"text",isNullable:!0,isText:!0,isTextType:!0}],embed:{},joinBy:{},join:{}},inventory:{isViewTable:!1,tableDesc:null,keys:["inventory_id"],foreignKeys:["film_id","store_id"],cols:["inventory_id","film_id","store_id","last_update"],columns:[{name:"inventory_id",table:"inventory",dataType:"integer",defaultValue:"nextval('inventory_inventory_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"film_id",table:"inventory",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"store_id",table:"inventory",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"last_update",table:"inventory",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0}],embed:{film_id:{from:{table:"inventory",field:"film_id"},to:{table:"film",key:"film_id"},constraint:"inventory_film_id_fkey"},store_id:{from:{table:"inventory",field:"store_id"},to:{table:"store",key:"store_id"},constraint:"inventory_store_store_id_fk"}},joinBy:{},join:{rental__inventory_id:{from:{table:"inventory",key:"inventory_id"},to:{table:"rental",field:"inventory_id"}}}},language:{isViewTable:!1,tableDesc:null,keys:["language_id"],foreignKeys:[],cols:["language_id","name","last_update"],columns:[{name:"language_id",table:"language",dataType:"integer",defaultValue:"nextval('language_language_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"name",table:"language",dataType:"character",maxLength:20,isChar:!0,isTextType:!0},{name:"last_update",table:"language",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0}],embed:{},joinBy:{},join:{film__language_id:{from:{table:"language",key:"language_id"},to:{table:"film",field:"language_id"}}}},nicer_but_slower_film_list:{isViewTable:!0,tableDesc:null,keys:[],foreignKeys:[],cols:["fid","title","description","category","price","length","rating","actors"],columns:[{name:"fid",table:"nicer_but_slower_film_list",dataType:"integer",isNullable:!0,isNumber:!0},{name:"title",table:"nicer_but_slower_film_list",dataType:"character varying",isNullable:!0,maxLength:255,isVarChar:!0,isTextType:!0},{name:"description",table:"nicer_but_slower_film_list",dataType:"text",isNullable:!0,isText:!0,isTextType:!0},{name:"category",table:"nicer_but_slower_film_list",dataType:"character varying",isNullable:!0,maxLength:25,isVarChar:!0,isTextType:!0},{name:"price",table:"nicer_but_slower_film_list",dataType:"numeric",isNullable:!0,isNumber:!0},{name:"length",table:"nicer_but_slower_film_list",dataType:"smallint",isNullable:!0,isNumber:!0},{name:"rating",table:"nicer_but_slower_film_list",dataType:"USER-DEFINED",isNullable:!0,enums:["G","PG","PG-13","R","NC-17"],isEnum:!0},{name:"actors",table:"nicer_but_slower_film_list",dataType:"text",isNullable:!0,isText:!0,isTextType:!0}],embed:{},joinBy:{},join:{}},payment:{isViewTable:!1,tableDesc:null,keys:["payment_id"],foreignKeys:["customer_id","rental_id","staff_id"],cols:["payment_id","customer_id","staff_id","rental_id","amount","payment_date"],columns:[{name:"payment_id",table:"payment",dataType:"integer",defaultValue:"nextval('payment_payment_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"customer_id",table:"payment",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"staff_id",table:"payment",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"rental_id",table:"payment",dataType:"integer",isNumber:!0,isForeignKey:!0},{name:"amount",table:"payment",dataType:"numeric",isNumber:!0},{name:"payment_date",table:"payment",dataType:"timestamp without time zone",isDate:!0}],embed:{customer_id:{from:{table:"payment",field:"customer_id"},to:{table:"customer",key:"customer_id"},constraint:"payment_customer_id_fkey"},rental_id:{from:{table:"payment",field:"rental_id"},to:{table:"rental",key:"rental_id"},constraint:"payment_rental_id_fkey"},staff_id:{from:{table:"payment",field:"staff_id"},to:{table:"staff",key:"staff_id"},constraint:"payment_staff_id_fkey"}},joinBy:{},join:{}},rental:{isViewTable:!1,tableDesc:null,keys:["rental_id"],foreignKeys:["customer_id","inventory_id","staff_id"],cols:["rental_id","rental_date","inventory_id","customer_id","return_date","staff_id","last_update"],columns:[{name:"rental_id",table:"rental",dataType:"integer",defaultValue:"nextval('rental_rental_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"rental_date",table:"rental",dataType:"timestamp without time zone",isDate:!0},{name:"inventory_id",table:"rental",dataType:"integer",isNumber:!0,isForeignKey:!0},{name:"customer_id",table:"rental",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"return_date",table:"rental",dataType:"timestamp without time zone",isNullable:!0,isDate:!0},{name:"staff_id",table:"rental",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"last_update",table:"rental",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0}],embed:{customer_id:{from:{table:"rental",field:"customer_id"},to:{table:"customer",key:"customer_id"},constraint:"rental_customer_id_fkey"},inventory_id:{from:{table:"rental",field:"inventory_id"},to:{table:"inventory",key:"inventory_id"},constraint:"rental_inventory_id_fkey"},staff_id:{from:{table:"rental",field:"staff_id"},to:{table:"staff",key:"staff_id"},constraint:"rental_staff_id_key"}},joinBy:{},join:{payment__rental_id:{from:{table:"rental",key:"rental_id"},to:{table:"payment",field:"rental_id"}}}},sales_by_film_category:{isViewTable:!0,tableDesc:null,keys:[],foreignKeys:[],cols:["category","total_sales"],columns:[{name:"category",table:"sales_by_film_category",dataType:"character varying",isNullable:!0,maxLength:25,isVarChar:!0,isTextType:!0},{name:"total_sales",table:"sales_by_film_category",dataType:"numeric",isNullable:!0,isNumber:!0}],embed:{},joinBy:{},join:{}},sales_by_store:{isViewTable:!0,tableDesc:null,keys:[],foreignKeys:[],cols:["store","manager","total_sales"],columns:[{name:"store",table:"sales_by_store",dataType:"text",isNullable:!0,isText:!0,isTextType:!0},{name:"manager",table:"sales_by_store",dataType:"text",isNullable:!0,isText:!0,isTextType:!0},{name:"total_sales",table:"sales_by_store",dataType:"numeric",isNullable:!0,isNumber:!0}],embed:{},joinBy:{},join:{}},staff:{isViewTable:!1,tableDesc:null,keys:["staff_id"],foreignKeys:["address_id"],cols:["staff_id","first_name","last_name","address_id","email","store_id","active","username","password","last_update","picture"],columns:[{name:"staff_id",table:"staff",dataType:"integer",defaultValue:"nextval('staff_staff_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"first_name",table:"staff",dataType:"character varying",maxLength:45,isVarChar:!0,isTextType:!0},{name:"last_name",table:"staff",dataType:"character varying",maxLength:45,isVarChar:!0,isTextType:!0},{name:"address_id",table:"staff",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"email",table:"staff",dataType:"character varying",isNullable:!0,maxLength:50,isVarChar:!0,isTextType:!0},{name:"store_id",table:"staff",dataType:"smallint",isNumber:!0},{name:"active",table:"staff",dataType:"boolean",defaultValue:"true",isBoolean:!0},{name:"username",table:"staff",dataType:"character varying",maxLength:16,isVarChar:!0,isTextType:!0},{name:"password",table:"staff",dataType:"character varying",isNullable:!0,maxLength:40,isVarChar:!0,isTextType:!0},{name:"last_update",table:"staff",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0},{name:"picture",table:"staff",dataType:"bytea",isNullable:!0}],embed:{address_id:{from:{table:"staff",field:"address_id"},to:{table:"address",key:"address_id"},constraint:"staff_address_id_fkey"}},joinBy:{store:{from:{table:"staff",key:"staff_id"},by:{table:"store",fromKey:"manager_staff_id",toKey:"address_id"},to:{table:"address",key:"address_id"}}},join:{payment__staff_id:{from:{table:"staff",key:"staff_id"},to:{table:"payment",field:"staff_id"}},rental__staff_id:{from:{table:"staff",key:"staff_id"},to:{table:"rental",field:"staff_id"}},store__manager_staff_id:{from:{table:"staff",key:"staff_id"},to:{table:"store",field:"manager_staff_id"}}}},staff_list:{isViewTable:!0,tableDesc:null,keys:[],foreignKeys:[],cols:["id","name","address","zip code","phone","city","country","sid"],columns:[{name:"id",table:"staff_list",dataType:"integer",isNullable:!0,isNumber:!0},{name:"name",table:"staff_list",dataType:"text",isNullable:!0,isText:!0,isTextType:!0},{name:"address",table:"staff_list",dataType:"character varying",isNullable:!0,maxLength:50,isVarChar:!0,isTextType:!0},{name:"zip code",table:"staff_list",dataType:"character varying",isNullable:!0,maxLength:10,isVarChar:!0,isTextType:!0},{name:"phone",table:"staff_list",dataType:"character varying",isNullable:!0,maxLength:20,isVarChar:!0,isTextType:!0},{name:"city",table:"staff_list",dataType:"character varying",isNullable:!0,maxLength:50,isVarChar:!0,isTextType:!0},{name:"country",table:"staff_list",dataType:"character varying",isNullable:!0,maxLength:50,isVarChar:!0,isTextType:!0},{name:"sid",table:"staff_list",dataType:"smallint",isNullable:!0,isNumber:!0}],embed:{},joinBy:{},join:{}},store:{isViewTable:!1,tableDesc:null,keys:["store_id"],foreignKeys:["address_id","manager_staff_id"],cols:["store_id","manager_staff_id","address_id","last_update"],columns:[{name:"store_id",table:"store",dataType:"integer",defaultValue:"nextval('store_store_id_seq'::regclass)",isNumber:!0,isKey:!0},{name:"manager_staff_id",table:"store",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"address_id",table:"store",dataType:"smallint",isNumber:!0,isForeignKey:!0},{name:"last_update",table:"store",dataType:"timestamp without time zone",defaultValue:"now()",isDate:!0}],embed:{address_id:{from:{table:"store",field:"address_id"},to:{table:"address",key:"address_id"},constraint:"store_address_id_fkey"},manager_staff_id:{from:{table:"store",field:"manager_staff_id"},to:{table:"staff",key:"staff_id"},constraint:"store_manager_staff_id_fkey"}},joinBy:{inventory:{from:{table:"store",key:"store_id"},by:{table:"inventory",fromKey:"store_id",toKey:"film_id"},to:{table:"film",key:"film_id"}}},join:{inventory__store_id:{from:{table:"store",key:"store_id"},to:{table:"inventory",field:"store_id"}}}}},config:{cols:{actor:["fullname"]},schema:{film:{release_year:function year(column){return{valueType:"select",renderFormItem:function renderFormItem(){return Object(jsx_runtime.jsx)(input_number.a,{min:1900,max:2030})},_search:search_select_selectColumn(column)}}}},options:{},baseColumns:{last_update:Object(objectSpread2.a)(Object(objectSpread2.a)({},valuetype_date),{},{editable:!1,_form:{valueType:"dateTime",readonly:!0}})},template:{embed:function embed(_ref,_ref2){_ref.table,_ref.name,_ref2.cols,_ref2.desc;return{}}}},subscribe:!0,baseSchema:"public"}),client_useSchema=schema_useSchema,index_stories_0_default=function _0_default(){return Object(jsx_runtime.jsx)(ui_table,Object(objectSpread2.a)({},client_useSchema("film")))},index_stories_1_light_table=function _1_light_table(){return Object(jsx_runtime.jsx)(table_LightTable,Object(objectSpread2.a)({},client_useSchema("film")))},index_stories_2_alter_column_display=function _2_alter_column_display(){return Object(jsx_runtime.jsx)(ui_table,Object(objectSpread2.a)({},client_useSchema("film",{title:{title:"电影名",render:function render(value){return Object(jsx_runtime.jsx)("div",{style:{fontWeight:"bold"},children:value})}}},{cols:["title"]})))},index_stories_3_search=function _3_search(){return Object(jsx_runtime.jsx)(ui_table,Object(objectSpread2.a)({},client_useSchema("film",{title:{_search:!1},release_year:{_search:{title:"发布年代 <=",_operator:"lte"}}},{cols:["title","release_year"]})))},index_stories_4_add_operates=function _4_add_operates(){return Object(jsx_runtime.jsx)(ui_table,Object(objectSpread2.a)(Object(objectSpread2.a)({},client_useSchema("film",{},{cols:["title","rating"]})),{},{operates:["create","inline_edit","edit",{name:"修改电影级别",form:["rating"]},{name:"修改电影为R级",fun:function fun(film,request){film.rating="R",request.update(film)},show:function show(film){return"R"!==film.rating}}]}))},index_stories_5_one_to_one_relation=function _5_one_to_one_relation(){return Object(jsx_runtime.jsx)(ui_table,Object(objectSpread2.a)({},client_useSchema("film",{},{cols:["title","language_id"]})))},index_stories_6_one_to_many_relation=function _6_one_to_many_relation(){return Object(jsx_runtime.jsx)(ui_table,Object(objectSpread2.a)({},client_useSchema("film",{},{cols:["title"],join:{inventory__film_id:{title:"影片库存"}}})))},index_stories_7_many_to_many_relation=function _7_many_to_many_relation(){return Object(jsx_runtime.jsx)(ui_table,Object(objectSpread2.a)({},client_useSchema("film",{film_id:{_search:!1}},{cols:["title"],joinBy:{film_category:{},film_actor:{}}})))};__webpack_exports__.default={title:"examples",decorators:[function(Story){return Object(jsx_runtime.jsx)(ClientContext_ClientProvider,{client:client_client,children:Object(jsx_runtime.jsx)(Story,{})})}]};index_stories_0_default.parameters=Object(objectSpread2.a)({storySource:{source:'() => <Table<Film> {...useSchema("film")} />'}},index_stories_0_default.parameters),index_stories_1_light_table.parameters=Object(objectSpread2.a)({storySource:{source:'() => <LightTable<Film> {...useSchema("film")} />'}},index_stories_1_light_table.parameters),index_stories_2_alter_column_display.parameters=Object(objectSpread2.a)({storySource:{source:'() => (\r\n  <Table<Film>\r\n    {...useSchema(\r\n      "film",\r\n      {\r\n        title: {\r\n          title: "电影名",\r\n          render: (value) => <div style={{ fontWeight: "bold" }}>{value}</div>,\r\n        },\r\n      },\r\n      { cols: ["title"] }\r\n    )}\r\n  />\r\n)'}},index_stories_2_alter_column_display.parameters),index_stories_3_search.parameters=Object(objectSpread2.a)({storySource:{source:'() => (\r\n  <Table<Film>\r\n    {...useSchema(\r\n      "film",\r\n      {\r\n        title: {\r\n          _search: false,\r\n        },\r\n        release_year: {\r\n          _search: {\r\n            title: "发布年代 <=",\r\n            _operator: "lte",\r\n          },\r\n        },\r\n      },\r\n      {\r\n        cols: ["title", "release_year"],\r\n      }\r\n    )}\r\n  />\r\n)'}},index_stories_3_search.parameters),index_stories_4_add_operates.parameters=Object(objectSpread2.a)({storySource:{source:'() => (\r\n  <Table<Film>\r\n    {...useSchema("film", {}, { cols: ["title", "rating"] })}\r\n    operates={[\r\n      "create",\r\n      "inline_edit",\r\n      "edit",\r\n      { name: "修改电影级别", form: ["rating"] },\r\n      {\r\n        name: "修改电影为R级",\r\n        fun: (film, request) => {\r\n          film.rating = "R"\r\n          request.update(film)\r\n        },\r\n        show: (film) => film.rating !== "R",\r\n      },\r\n    ]}\r\n  />\r\n)'}},index_stories_4_add_operates.parameters),index_stories_5_one_to_one_relation.parameters=Object(objectSpread2.a)({storySource:{source:'() => (\r\n  <Table<Film>\r\n    {...useSchema(\r\n      "film",\r\n      {},\r\n      {\r\n        cols: ["title", "language_id"],\r\n      }\r\n    )}\r\n  />\r\n)'}},index_stories_5_one_to_one_relation.parameters),index_stories_6_one_to_many_relation.parameters=Object(objectSpread2.a)({storySource:{source:'() => (\r\n  <Table<Film>\r\n    {...useSchema(\r\n      "film",\r\n      {},\r\n      {\r\n        cols: ["title"],\r\n        join: { inventory__film_id: { title: "影片库存" } },\r\n      }\r\n    )}\r\n  />\r\n)'}},index_stories_6_one_to_many_relation.parameters),index_stories_7_many_to_many_relation.parameters=Object(objectSpread2.a)({storySource:{source:'() => (\r\n  <Table<Film>\r\n    {...useSchema(\r\n      "film",\r\n      {\r\n        film_id: {\r\n          _search: false,\r\n        },\r\n      },\r\n      {\r\n        cols: ["title"],\r\n        joinBy: { film_category: {}, film_actor: {} },\r\n      }\r\n    )}\r\n  />\r\n)'}},index_stories_7_many_to_many_relation.parameters),index_stories_0_default.__docgenInfo={description:"",methods:[],displayName:"_0_default"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\dvdrental\\index.stories.tsx"]={name:"_0_default",docgenInfo:index_stories_0_default.__docgenInfo,path:"src\\dvdrental\\index.stories.tsx"}),index_stories_1_light_table.__docgenInfo={description:"",methods:[],displayName:"_1_light_table"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\dvdrental\\index.stories.tsx"]={name:"_1_light_table",docgenInfo:index_stories_1_light_table.__docgenInfo,path:"src\\dvdrental\\index.stories.tsx"}),index_stories_2_alter_column_display.__docgenInfo={description:"",methods:[],displayName:"_2_alter_column_display"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\dvdrental\\index.stories.tsx"]={name:"_2_alter_column_display",docgenInfo:index_stories_2_alter_column_display.__docgenInfo,path:"src\\dvdrental\\index.stories.tsx"}),index_stories_3_search.__docgenInfo={description:"",methods:[],displayName:"_3_search"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\dvdrental\\index.stories.tsx"]={name:"_3_search",docgenInfo:index_stories_3_search.__docgenInfo,path:"src\\dvdrental\\index.stories.tsx"}),index_stories_4_add_operates.__docgenInfo={description:"",methods:[],displayName:"_4_add_operates"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\dvdrental\\index.stories.tsx"]={name:"_4_add_operates",docgenInfo:index_stories_4_add_operates.__docgenInfo,path:"src\\dvdrental\\index.stories.tsx"}),index_stories_5_one_to_one_relation.__docgenInfo={description:"",methods:[],displayName:"_5_one_to_one_relation"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\dvdrental\\index.stories.tsx"]={name:"_5_one_to_one_relation",docgenInfo:index_stories_5_one_to_one_relation.__docgenInfo,path:"src\\dvdrental\\index.stories.tsx"}),index_stories_6_one_to_many_relation.__docgenInfo={description:"",methods:[],displayName:"_6_one_to_many_relation"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\dvdrental\\index.stories.tsx"]={name:"_6_one_to_many_relation",docgenInfo:index_stories_6_one_to_many_relation.__docgenInfo,path:"src\\dvdrental\\index.stories.tsx"}),index_stories_7_many_to_many_relation.__docgenInfo={description:"",methods:[],displayName:"_7_many_to_many_relation"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\dvdrental\\index.stories.tsx"]={name:"_7_many_to_many_relation",docgenInfo:index_stories_7_many_to_many_relation.__docgenInfo,path:"src\\dvdrental\\index.stories.tsx"})},1300:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var preview_namespaceObject={};__webpack_require__.r(preview_namespaceObject),__webpack_require__.d(preview_namespaceObject,"parameters",(function(){return parameters}));var client_api=__webpack_require__(1324),esm=__webpack_require__(26),parameters={actions:{argTypesRegex:"^on[A-Z].*"},controls:{matchers:{color:/(background|color)$/i,date:/Date$/}},docs:{source:{state:"open"}}};function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.keys(preview_namespaceObject).forEach((function(key){var value=preview_namespaceObject[key];switch(key){case"args":case"argTypes":return esm.a.warn("Invalid args/argTypes in config, ignoring.",JSON.stringify(value));case"decorators":return value.forEach((function(decorator){return Object(client_api.c)(decorator,!1)}));case"loaders":return value.forEach((function(loader){return Object(client_api.d)(loader,!1)}));case"parameters":return Object(client_api.e)(function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({},value),!1);case"argTypesEnhancers":return value.forEach((function(enhancer){return Object(client_api.a)(enhancer)}));case"argsEnhancers":return value.forEach((function(enhancer){return Object(client_api.b)(enhancer)}));case"render":return Object(client_api.g)(value);case"globals":case"globalTypes":var v={};return v[key]=value,Object(client_api.e)(v,!1);default:return console.log(key+" was not supported :( !")}}))},792:function(module,exports,__webpack_require__){__webpack_require__(793),__webpack_require__(950),__webpack_require__(951),__webpack_require__(1298),__webpack_require__(1297),__webpack_require__(1299),__webpack_require__(1300),module.exports=__webpack_require__(1139)},860:function(module,exports){},951:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(600)}},[[792,2,3]]]);